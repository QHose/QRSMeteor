<template name="SSO">
    <div class="ui container">
        <h3>Single sign on (ticket request) redirect demo page</h3>
        <p>To slow things down for demo purposes we have put a "page in the middle".
            <ul>
                <li>between the user trying to access Qlik Sense</li>
                <li>and the demo site (your SaaS platform), in which the user is already logged in. So this is a perfect place to get the users id and groups (or any array of fields you would like to use to authorize on) and communicate these values to the Qlik Sense Proxy via the ticketing process.</li>
                <li>This allows Qlik Sense to re-use these groups in the resource and "row/column level" authorizations.</li>
            </ul>
            <div class="ui accordion">
                <div class="title">
                    <a href="" class="ui dropdown icon"></a>Read more...
                </div>
                <div class="content">
                    <h4>Introduction</h4>
                    <p> In production scenarios you won't see this page and it would be an automatic redirect from your SaaS platform to Qlik Sense. But then everything would go too fast to see what is happening umder the hood. To slow things down we have put this page in the middle. This and the <a target="_blank" href="{{pathFor 'APILogs'}}">API Calls</a> page allow us to explain you the security for the demo platform. Each time you switch a user you will see this page. Because each time you swith a user, we will log out "all" users using the QPS API, and we will request a new ticket for the selected user. </p>
                    <h4>New ticket for each selected user</h4>
                    <p>On this page you will see a large green button. If you click it, Meteor (or your SaaS platform) will get the current selected (logged in) user and its group membership out of MongoDB. Then it will request a ticket for this user and groups (server side). After receiving the ticket, we try to redirect the user back to Qlik Sense for the URL he initially tried to access (targetURL) with the ticket appended in the URL.</p>
                    <h4>Technical background</h4>
                    <p>What basically happens it that we are "constantly changing the url of the browser".
                        <ul>
                            <li> First the user tries to open a page with Qlik Sense embedded. So the browser hits the Qlik Sense Proxy because an IFrame or DIV points to a URL which includes the proxy path.</li>
                            <li> We configured the proxy so that only authenticated users are allowed to pass. This basically means that the user needs to have a valid "virtual proxy specific" session cookie.</li>
                            <li> Qlik Sense Proxy redirects the users' browser to the page you are currently watching (the "authentication redirect" setting of the virtual proxy). We have to store somewhere what the URL of the proxy QPS API is, and which page the user tried to access, therefore the Proxy included the parameters below which we can use to redirect the user (change the url of the browser) after we received the ticket. For more information also see the <a href="https://help.qlik.com/en-US/sense-developer/3.0/Subsystems/ProxyServiceAPI/Content/ProxyServiceAPI/ProxyServiceAPI-ProxyServiceAPI-Authentication.htm">help.</a></li>
                            <ul>
                                {{#with receivedParamsQlikSense}}
                                <li>proxyRestUri: {{proxyRestUri}}</li>
                                <li>targetId: {{targetId}} (if you supply this in your ticket request, you will get the orginal URL the user tried to open back)</li>
                                {{/with}}
                            </ul>
                        </ul>
                    </p>
                    <h3>Sequence diagram of the ticketing process flow</h3>
                    <iframe src="{{seq_ticketing_flow}}" width="100%" height="700"></iframe>
                </div>
            </div>
        </p>
        <div class="ui mini buttons">
            <a href="{{pathFor 'introductionSecurity'}}" class="ui button" target="_blank">Read more about Security</a>
            <div class="or"></div>
            <button class="ui positive button">Request a ticket for the logged in user</button>
        </div>
    </div>
</template>
