{"version":3,"sources":["meteor://ðŸ’»app/packages/mongo-id/id.js"],"names":["module","export","MongoID","EJSON","watch","require","v","Random","_looksLikeObjectID","str","length","match","ObjectID","constructor","hexString","toLowerCase","Error","_str","equals","other","valueOf","toString","clone","typeName","getTimestamp","Number","parseInt","substr","toJSONValue","toHexString","addType","idStringify","id","startsWith","undefined","JSON","stringify","idParse","parse"],"mappings":"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","file":"/packages/mongo-id.js","sourcesContent":["import { EJSON } from 'meteor/ejson';\nimport { Random } from 'meteor/random';\n\nconst MongoID = {};\n\nMongoID._looksLikeObjectID = str => str.length === 24 && str.match(/^[0-9a-f]*$/);\n\nMongoID.ObjectID = class ObjectID {\n  constructor (hexString) {\n    //random-based impl of Mongo ObjectID\n    if (hexString) {\n      hexString = hexString.toLowerCase();\n      if (!MongoID._looksLikeObjectID(hexString)) {\n        throw new Error('Invalid hexadecimal string for creating an ObjectID');\n      }\n      // meant to work with _.isEqual(), which relies on structural equality\n      this._str = hexString;\n    } else {\n      this._str = Random.hexString(24);\n    }\n  }\n\n  equals(other) {\n    return other instanceof MongoID.ObjectID &&\n    this.valueOf() === other.valueOf();\n  }\n\n  toString() {\n    return `ObjectID(\"${this._str}\")`;\n  }\n\n  clone() {\n    return new MongoID.ObjectID(this._str);\n  }\n\n  typeName() {\n    return 'oid';\n  }\n  \n  getTimestamp() {\n    return Number.parseInt(this._str.substr(0, 8), 16);\n  }\n\n  valueOf() {\n    return this._str;\n  }\n\n  toJSONValue() {\n    return this.valueOf();\n  }\n\n  toHexString() {\n    return this.valueOf();\n  }\n\n}\n\nEJSON.addType('oid', str => new MongoID.ObjectID(str));\n\nMongoID.idStringify = (id) => {\n  if (id instanceof MongoID.ObjectID) {\n    return id.valueOf();\n  } else if (typeof id === 'string') {\n    if (id === '') {\n      return id;\n    } else if (id.startsWith('-') || // escape previously dashed strings\n               id.startsWith('~') || // escape escaped numbers, true, false\n               MongoID._looksLikeObjectID(id) || // escape object-id-form strings\n               id.startsWith('{')) { // escape object-form strings, for maybe implementing later\n      return `-${id}`;\n    } else {\n      return id; // other strings go through unchanged.\n    }\n  } else if (id === undefined) {\n    return '-';\n  } else if (typeof id === 'object' && id !== null) {\n    throw new Error('Meteor does not currently support objects other than ObjectID as ids');\n  } else { // Numbers, true, false, null\n    return `~${JSON.stringify(id)}`;\n  }\n};\n\nMongoID.idParse = (id) => {\n  if (id === '') {\n    return id;\n  } else if (id === '-') {\n    return undefined;\n  } else if (id.startsWith('-')) {\n    return id.substr(1);\n  } else if (id.startsWith('~')) {\n    return JSON.parse(id.substr(1));\n  } else if (MongoID._looksLikeObjectID(id)) {\n    return new MongoID.ObjectID(id);\n  } else {\n    return id;\n  }\n};\n\nexport { MongoID };\n"]}