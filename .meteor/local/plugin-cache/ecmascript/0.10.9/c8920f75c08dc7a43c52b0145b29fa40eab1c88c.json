{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/ui/useCases/useCaseSelection.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/useCases/useCaseSelection.js","filename":"imports/ui/useCases/useCaseSelection.js","sourceMaps":true,"passPerPreset":false,"envName":"development","cwd":"/home/martijn/Documents/GitHub/QRSMeteor","root":"/home/martijn/Documents/GitHub/QRSMeteor","generatorOpts":{"filename":"imports/ui/useCases/useCaseSelection.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/useCases/useCaseSelection.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nmodule.export({\n  initQlikSense: function () {\n    return initQlikSense;\n  },\n  getSlideGenApp: function () {\n    return getSlideGenApp;\n  },\n  getAllSlideHeaders: function () {\n    return getAllSlideHeaders;\n  },\n  getSubjectArea: function () {\n    return getSubjectArea;\n  },\n  getLevel2: function () {\n    return getLevel2;\n  },\n  getLevel1: function () {\n    return getLevel1;\n  },\n  getAllSlideHeadersPlain: function () {\n    return getAllSlideHeadersPlain;\n  },\n  getAllSlides: function () {\n    return getAllSlides;\n  },\n  getComment: function () {\n    return getComment;\n  },\n  setChangeListener: function () {\n    return setChangeListener;\n  }\n});\nmodule.watch(require(\"/imports/ui/useCases/useCaseSelection.html\"));\nmodule.watch(require(\"/imports/ui/slideGenerator/slides.html\"));\nmodule.watch(require(\"/imports/ui/slideGenerator/slides\"));\nmodule.watch(require(\"/imports/ui/slideGenerator/slides.css\"));\nvar nav;\nmodule.watch(require(\"/imports/ui/nav.js\"), {\n  \"*\": function (v) {\n    nav = v;\n  }\n}, 0);\nvar SenseSelections;\nmodule.watch(require(\"/imports/api/logger\"), {\n  SenseSelections: function (v) {\n    SenseSelections = v;\n  }\n}, 1);\nmodule.watch(require(\"./SSBI/SSBI.js\"));\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar config;\nmodule.watch(require(\"/imports/api/config.js\"), {\n  senseConfig: function (v) {\n    config = v;\n  }\n}, 3);\nconsole.log(\"🚀 ~ file: useCaseSelection.js:10 ~ config:\", config);\n\nvar schema = require(\"enigma.js/schemas/3.2.json\"); // import {\n//     APILogs,\n//     REST_Log\n// } from '/imports/api/APILogs';\n\n\nvar enigma = require(\"enigma.js\"); // const schema = require(\"enigma.js/schemas/12.20.0.json\");\n\n\nvar Cookies = require(\"js-cookie\");\n\nvar Reveal = require(\"reveal.js\");\n\nvar qix = null;\nvar possibleRoles = [\"Developer\", \"Hosting Ops\", \"Business Analyst\", \"CTO\", \"C-Level - non-technical\"];\n\nfunction initQlikSense() {\n  return _regenerator.default.async(function () {\n    function initQlikSense$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regenerator.default.awrap(makeSureSenseIsConnected());\n\n          case 2:\n            qix = _context.sent;\n            _context.next = 5;\n            return _regenerator.default.awrap(setChangeListener(qix));\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }\n\n    return initQlikSense$;\n  }(), null, this);\n}\n\nfunction makeSureSenseIsConnected() {\n  return _regenerator.default.async(function () {\n    function makeSureSenseIsConnected$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.t0 = _regenerator.default;\n            _context2.t1 = getSlideGenApp;\n            _context2.next = 4;\n            return _regenerator.default.awrap(getTicket());\n\n          case 4:\n            _context2.t2 = _context2.sent;\n            _context2.t3 = (0, _context2.t1)(_context2.t2);\n            _context2.next = 8;\n            return _context2.t0.awrap.call(_context2.t0, _context2.t3);\n\n          case 8:\n            return _context2.abrupt(\"return\", _context2.sent);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }\n\n    return makeSureSenseIsConnected$;\n  }(), null, this);\n}\n\nfunction getSlideGenApp(ticket) {\n  var ticketUrl, engineConfig, session, _possibleEnigmaErr, global, doc;\n\n  return _regenerator.default.async(function () {\n    function getSlideGenApp$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            ticketUrl = ticket ? \"?QlikTicket=\" + ticket : \"\";\n            engineConfig = {\n              schema: schema,\n              url: (config.useSSL ? \"wss\" : \"ws\") + \"://\" + config.host + \":\" + (config.useSSL ? Meteor.settings.public.qlikSensePortSecure : Meteor.settings.public.qlikSensePort) + \"/\" + Meteor.settings.public.slideGenerator.virtualProxy + \"/app/\" + config.slideGeneratorAppId + ticketUrl\n            };\n            _context4.prev = 2;\n            // create a new session:\n            session = enigma.create(engineConfig); // console.log(`Connecting to ${session.config.url}`);\n            //https://github.com/qlik-oss/enigma.js/blob/master/examples/basics/events/session.js\n            // bind traffic events to log what is sent and received on the socket:\n            // session.on(\"traffic:sent\", (data) => console.log(\"sent:\", data));\n            // session.on(\"traffic:received\", (data) => console.log(\"received:\", data));\n            // Catch possible errors sent on WebSocket\n\n            session.on(\"traffic:received\", function (res) {\n              if (res.params && res.params.severity === \"fatal\") {\n                _possibleEnigmaErr = res.params.message;\n              }\n            });\n            session.on('traffic:received', function () {\n              function _callee(data) {\n                return _regenerator.default.async(function () {\n                  function _callee$(_context3) {\n                    while (1) {\n                      switch (_context3.prev = _context3.next) {\n                        case 0:\n                          if (data.method === 'OnAuthenticationInformation' && data.params.mustAuthenticate === true) {\n                            console.error('User is not authenticated... Redirect to root URL');\n                            window.location.href = window.location.origin;\n                          }\n\n                        case 1:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                  }\n\n                  return _callee$;\n                }(), null, this);\n              }\n\n              return _callee;\n            }());\n            session.on('notification:*', function (name) {\n              return console.log(\"Session: Notification event: \" + name);\n            }); // open the socket and eventually receive the QIX global API, and then close\n            // the session:\n\n            _context4.prev = 7;\n            _context4.next = 10;\n            return _regenerator.default.awrap(session.open());\n\n          case 10:\n            global = _context4.sent;\n            _context4.next = 16;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t0 = _context4[\"catch\"](7);\n            console.log(\"Error getting the global connection\", _context4.t0);\n\n          case 16:\n            _context4.prev = 16;\n            _context4.next = 19;\n            return _regenerator.default.awrap(global.openDoc(config.slideGeneratorAppId));\n\n          case 19:\n            doc = _context4.sent;\n            console.log(\"********** User is authenticated and connected to the app, Session: Document id: \" + doc.id);\n            return _context4.abrupt(\"return\", doc);\n\n          case 24:\n            _context4.prev = 24;\n            _context4.t1 = _context4[\"catch\"](16);\n            console.error(\"🚀 ~ file: useCaseSelection.js:68 ~ error:\", _context4.t1);\n\n          case 27:\n            _context4.next = 33;\n            break;\n\n          case 29:\n            _context4.prev = 29;\n            _context4.t2 = _context4[\"catch\"](2);\n\n            if (_context4.t2.enigmaError) {\n              console.error(\"Enigma error:\", possibleEnigmaErr || _context4.t2);\n            } else {\n              console.error(\"Qlik Sense Qix error, cannot make a websocket connection from the browser to Sense. \", _context4.t2);\n            }\n\n            sAlert.error(_context4.t2.message); // window.location.href = window.location.origin;\n\n          case 33:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }\n\n    return getSlideGenApp$;\n  }(), null, this, [[2, 29], [7, 13], [16, 24]]);\n}\n\n//make sure you go to the first slide when we have new slide data\nTracker.autorun(function () {\n  Session.get(\"slideHeaders\");\n  Meteor.setTimeout(function () {\n    try {\n      Reveal.slide(0);\n    } catch (error) {}\n  }, 500);\n}); // ONRENDERED.\n\nTemplate.useCaseSelection.onRendered(function () {\n  function _callee2() {\n    var textToShow, hasClass, menuItems1, timer1, timer2;\n    return _regenerator.default.async(function () {\n      function _callee2$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              hasClass = function () {\n                function _ref(el, className) {\n                  if (el.classList) {\n                    return el.classList.contains(className);\n                  } else {\n                    return new RegExp(\"(^| )\" + className + \"( |$)\", \"gi\").test(el.className);\n                  }\n                }\n\n                return _ref;\n              }();\n\n              Session.set(\"showSelector\", false);\n              this.$(\"#flyoutnavkbfixed\").focus();\n              $(\".ui.dropdown\").dropdown(\"refresh\");\n              textToShow = Cookies.get(\"currentMainRole\") ? Cookies.get(\"currentMainRole\") : \"Your role?\";\n              $(\".ui.dropdown\").dropdown(\"set selected\", textToShow);\n              !function () {\n                var w = window,\n                    d = w.document;\n\n                if (w.onfocusin === undefined) {\n                  d.addEventListener(\"focus\", addPolyfill, true);\n                  d.addEventListener(\"blur\", addPolyfill, true);\n                  d.addEventListener(\"focusin\", removePolyfill, true);\n                  d.addEventListener(\"focusout\", removePolyfill, true);\n                }\n\n                function addPolyfill(e) {\n                  var type = e.type === \"focus\" ? \"focusin\" : \"focusout\";\n                  var event = new CustomEvent(type, {\n                    bubbles: true,\n                    cancelable: false\n                  });\n                  event.c1Generated = true;\n                  e.target.dispatchEvent(event);\n                }\n\n                function removePolyfill(e) {\n                  if (!e.c1Generated) {\n                    // focus after focusin, so chrome will the first time trigger tow times focusin\n                    d.removeEventListener(\"focus\", addPolyfill, true);\n                    d.removeEventListener(\"blur\", addPolyfill, true);\n                    d.removeEventListener(\"focusin\", removePolyfill, true);\n                    d.removeEventListener(\"focusout\", removePolyfill, true);\n                  }\n\n                  setTimeout(function () {\n                    d.removeEventListener(\"focusin\", removePolyfill, true);\n                    d.removeEventListener(\"focusout\", removePolyfill, true);\n                  });\n                }\n              }();\n              menuItems1 = document.querySelectorAll(\"#flyoutnavkbfixed li.has-submenu\");\n              Array.prototype.forEach.call(menuItems1, function (el, i) {\n                el.addEventListener(\"mouseover\", function (event) {\n                  this.className = \"has-submenu open\";\n                  clearTimeout(timer1);\n                });\n                el.addEventListener(\"mouseout\", function (event) {\n                  timer1 = setTimeout(function (event) {\n                    var opennav = document.querySelector(\"#flyoutnavkbfixed .has-submenu.open\");\n                    opennav.className = \"has-submenu\";\n                    opennav.querySelector(\"a\").setAttribute(\"aria-expanded\", \"false\");\n                  }, 1000);\n                });\n                el.querySelector(\"a\").addEventListener(\"click\", function (event) {\n                  if (this.parentNode.className == \"has-submenu\") {\n                    this.parentNode.className = \"has-submenu open\";\n                    this.setAttribute(\"aria-expanded\", \"true\");\n                  } else {\n                    this.parentNode.className = \"has-submenu\";\n                    this.setAttribute(\"aria-expanded\", \"false\");\n                  }\n\n                  event.preventDefault();\n                });\n                var links = el.querySelectorAll(\"a\");\n                Array.prototype.forEach.call(links, function (el, i) {\n                  el.addEventListener(\"focus\", function () {\n                    if (timer2) {\n                      clearTimeout(timer2);\n                      timer2 = null;\n                    }\n                  });\n                  el.addEventListener(\"blur\", function (event) {\n                    timer2 = setTimeout(function () {\n                      var opennav = document.querySelector(\"#flyoutnavkbfixed .has-submenu.open\");\n\n                      if (opennav) {\n                        opennav.className = \"has-submenu\";\n                        opennav.querySelector(\"a\").setAttribute(\"aria-expanded\", \"false\");\n                      }\n                    }, 10);\n                  });\n                });\n              });\n\n            case 9:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, this);\n  }\n\n  return _callee2;\n}()); //\n// ─── SLIDE GENERATOR BUTTON CLICK ─────────────────────────────────────────────────────────────────────\n//\n\nTemplate.useCaseSelection.events({\n  \"click .slides\": function () {\n    function _callee3(e, t) {\n      return _regenerator.default.async(function () {\n        function _callee3$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                Session.set(\"showSelector\", true);\n                Router.go(\"slides\");\n\n              case 2:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }\n\n        return _callee3$;\n      }(), null, this);\n    }\n\n    return _callee3;\n  }(),\n  \"click #CM\": function () {\n    function _callee4(e, t) {\n      return _regenerator.default.async(function () {\n        function _callee4$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                window.open(\"https://evaluation.qlik.com\", \"_blank\").focus();\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }\n\n        return _callee4$;\n      }(), null, this);\n    }\n\n    return _callee4;\n  }(),\n  \"click #videoButton\": function () {\n    function _callee5(e, t) {\n      return _regenerator.default.async(function () {\n        function _callee5$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                nav.selectMenuItemInSense(\"*Video overview:*\");\n\n              case 1:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }\n\n        return _callee5$;\n      }(), null, this);\n    }\n\n    return _callee5;\n  }(),\n  \"click #CM2SAAS\": function () {\n    function _callee6(e, t) {\n      var selectedRole;\n      return _regenerator.default.async(function () {\n        function _callee6$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                //if anaything happens with the dropdown box... adjust the selection, and get new slides.\n                selectedRole = \"Client managed to SaaS\"; //e.currentTarget.id;\n\n                _context9.next = 3;\n                return _regenerator.default.awrap(getSlides(selectedRole));\n\n              case 3:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }\n\n        return _callee6$;\n      }(), null, this);\n    }\n\n    return _callee6;\n  }(),\n  \"click #SAAS\": function () {\n    function _callee7(e, t) {\n      var selectedRole;\n      return _regenerator.default.async(function () {\n        function _callee7$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                //if anaything happens with the dropdown box... adjust the selection, and get new slides.\n                selectedRole = \"Qlik Cloud\"; //e.currentTarget.id;\n\n                _context10.next = 3;\n                return _regenerator.default.awrap(getSlides(selectedRole));\n\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }\n\n        return _callee7$;\n      }(), null, this);\n    }\n\n    return _callee7;\n  }()\n});\n\nfunction getSlides(selectedRole) {\n  return _regenerator.default.async(function () {\n    function getSlides$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            Cookies.set(\"currentMainRole\", selectedRole); // await nav.makeClearAll(); already in set selection\n\n            _context11.next = 3;\n            return _regenerator.default.awrap(setSelectionInSense(\"Partial Workshop\", selectedRole));\n\n          case 3:\n            _context11.next = 5;\n            return _regenerator.default.awrap(getAllSlides());\n\n          case 5:\n            Session.set(\"showSelector\", false);\n            Session.set(\"showSubjectAreaIntroduction\", true);\n            Router.go(\"slides\"); ////go to the first slide after a data refresh.\n            // Reveal.slide(0);\n\n          case 8:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }\n\n    return getSlides$;\n  }(), null, this);\n}\n\nfunction setSelectionInSense(field, value) {\n  var qix, myField, result;\n  return _regenerator.default.async(function () {\n    function setSelectionInSense$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            _context12.prev = 0;\n            _context12.next = 3;\n            return _regenerator.default.awrap(getSlideGenApp());\n\n          case 3:\n            qix = _context12.sent;\n            _context12.next = 6;\n            return _regenerator.default.awrap(qix.clearAll());\n\n          case 6:\n            _context12.next = 8;\n            return _regenerator.default.awrap(qix.getField(field));\n\n          case 8:\n            myField = _context12.sent;\n            _context12.next = 11;\n            return _regenerator.default.awrap(myField.selectValues([{\n              qText: value\n            }]));\n\n          case 11:\n            result = _context12.sent;\n            _context12.next = 17;\n            break;\n\n          case 14:\n            _context12.prev = 14;\n            _context12.t0 = _context12[\"catch\"](0);\n            console.error(\"Error making selection in Sense \", _context12.t0);\n\n          case 17:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }\n\n    return setSelectionInSense$;\n  }(), null, this, [[0, 14]]);\n}\n\nfunction getTicket() {\n  var message;\n  return _regenerator.default.async(function () {\n    function getTicket$(_context13) {\n      while (1) {\n        switch (_context13.prev = _context13.next) {\n          case 0:\n            _context13.prev = 0;\n            _context13.next = 3;\n            return _regenerator.default.awrap(Meteor.callPromise(\"getTicketNumber\", {\n              group: \"notProvided\"\n            }, Meteor.settings.public.slideGenerator.virtualProxy));\n\n          case 3:\n            return _context13.abrupt(\"return\", _context13.sent);\n\n          case 6:\n            _context13.prev = 6;\n            _context13.t0 = _context13[\"catch\"](0);\n            message = \"We could not setup single sing on with Qlik Sense. See your console window for more information\";\n            console.error(message, _context13.t0);\n            sAlert.error(\"Could not get a ticket in order to enforce SSO to Qlik Sense.\");\n\n          case 11:\n          case \"end\":\n            return _context13.stop();\n        }\n      }\n    }\n\n    return getTicket$;\n  }(), null, this, [[0, 6]]);\n} //HELPERS\n\n\nTemplate.useCaseSelection.helpers({\n  userRole: function () {\n    return Cookies.get(\"currentMainRole\");\n  }\n}); //\n// ─── MAIN TOPICS LEVEL 1 AND 2 ─────────────────────────────────────────────────\n//\n\nfunction getAllSlideHeaders(qix) {\n  var headers, headersWithBreakers;\n  return _regenerator.default.async(function () {\n    function getAllSlideHeaders$(_context14) {\n      while (1) {\n        switch (_context14.prev = _context14.next) {\n          case 0:\n            _context14.next = 2;\n            return _regenerator.default.awrap(getAllSlideHeadersPlain(qix));\n\n          case 2:\n            headers = _context14.sent;\n            headersWithBreakers = insertSectionBreakers(headers);\n            return _context14.abrupt(\"return\", headersWithBreakers);\n\n          case 5:\n          case \"end\":\n            return _context14.stop();\n        }\n      }\n    }\n\n    return getAllSlideHeaders$;\n  }(), null, this);\n}\n\nfunction getSubjectArea(qix) {\n  var sessionModel;\n  return _regenerator.default.async(function () {\n    function getSubjectArea$(_context15) {\n      while (1) {\n        switch (_context15.prev = _context15.next) {\n          case 0:\n            _context15.next = 2;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"cube\"\n              },\n              qHyperCubeDef: {\n                qDimensions: [{\n                  qDef: {\n                    qFieldDefs: [\"Subject area\"],\n                    qSortCriterias: [{\n                      qSortByState: 0,\n                      qSortByFrequency: 0,\n                      qSortByNumeric: 0,\n                      qSortByAscii: 1,\n                      qSortByLoadOrder: 0,\n                      qSortByExpression: 0,\n                      qExpression: {\n                        qv: \"max(CSVRowNo)\"\n                      },\n                      qSortByGreyness: 0\n                    }]\n                  }\n                }]\n              }\n            }));\n\n          case 2:\n            sessionModel = _context15.sent;\n            _context15.next = 5;\n            return _regenerator.default.awrap(sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [{\n              qTop: 0,\n              qLeft: 0,\n              qWidth: 3,\n              qHeight: 3333\n            }]));\n\n          case 5:\n            sessionData = _context15.sent;\n            console.log(\"🚀 ~ file: useCaseSelection.js:322 ~ getSubjectArea ~ sessionData[0].qMatrix:\", sessionData[0].qMatrix);\n            return _context15.abrupt(\"return\", sessionData[0].qMatrix);\n\n          case 8:\n          case \"end\":\n            return _context15.stop();\n        }\n      }\n    }\n\n    return getSubjectArea$;\n  }(), null, this);\n}\n\nfunction getLevel2(qix) {\n  var sessionModel;\n  return _regenerator.default.async(function () {\n    function getLevel2$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            _context16.next = 2;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"cube\"\n              },\n              qHyperCubeDef: {\n                qDimensions: [{\n                  qDef: {\n                    qFieldDefs: [\"Level 2\"]\n                  }\n                }]\n              }\n            }));\n\n          case 2:\n            sessionModel = _context16.sent;\n            _context16.next = 5;\n            return _regenerator.default.awrap(sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [{\n              qTop: 0,\n              qLeft: 0,\n              qWidth: 3,\n              qHeight: 3333\n            }]));\n\n          case 5:\n            sessionData = _context16.sent;\n            return _context16.abrupt(\"return\", sessionData[0].qMatrix);\n\n          case 7:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }\n\n    return getLevel2$;\n  }(), null, this);\n}\n\nfunction getLevel1(qix) {\n  var sessionModel;\n  return _regenerator.default.async(function () {\n    function getLevel1$(_context17) {\n      while (1) {\n        switch (_context17.prev = _context17.next) {\n          case 0:\n            _context17.next = 2;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"cube\"\n              },\n              qHyperCubeDef: {\n                qDimensions: [{\n                  qDef: {\n                    qFieldDefs: [\"Level 1\"]\n                  }\n                }],\n                qMeasures: [{\n                  qDef: {\n                    qDef: \"Sum({$< [Level 1]= > } 1)\"\n                  },\n                  qLabel: \"sum({1}1)\",\n                  qLibraryId: null,\n                  qSortBy: {\n                    qSortByState: 0,\n                    qSortByFrequency: 0,\n                    qSortByNumeric: 0,\n                    qSortByAscii: 0,\n                    qSortByLoadOrder: 0,\n                    qSortByExpression: 1,\n                    qExpression: {\n                      qv: \"min(CSVRowNo)\"\n                    }\n                  }\n                }]\n              }\n            }));\n\n          case 2:\n            sessionModel = _context17.sent;\n            _context17.next = 5;\n            return _regenerator.default.awrap(sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [{\n              qTop: 0,\n              qLeft: 0,\n              qWidth: 3,\n              qHeight: 3333\n            }]));\n\n          case 5:\n            sessionData = _context17.sent;\n            return _context17.abrupt(\"return\", sessionData[0].qMatrix);\n\n          case 7:\n          case \"end\":\n            return _context17.stop();\n        }\n      }\n    }\n\n    return getLevel1$;\n  }(), null, this);\n}\n\nfunction getAllSlideHeadersPlain(qix) {\n  var sessionModel;\n  return _regenerator.default.async(function () {\n    function getAllSlideHeadersPlain$(_context18) {\n      while (1) {\n        switch (_context18.prev = _context18.next) {\n          case 0:\n            _context18.next = 2;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"cube\"\n              },\n              qHyperCubeDef: {\n                qDimensions: [{\n                  qDef: {\n                    qFieldDefs: [\"Level 1\"]\n                  }\n                }, {\n                  qDef: {\n                    qFieldDefs: [\"Level 2\"],\n                    qSortCriterias: [{\n                      qSortByState: 0,\n                      qSortByFrequency: 0,\n                      qSortByNumeric: 0,\n                      qSortByAscii: 0,\n                      qSortByLoadOrder: 1,\n                      qSortByExpression: 1,\n                      qExpression: {\n                        qv: \"min(CSVRowNo)\"\n                      },\n                      qSortByGreyness: 0\n                    }]\n                  }\n                }]\n              }\n            }));\n\n          case 2:\n            sessionModel = _context18.sent;\n            _context18.next = 5;\n            return _regenerator.default.awrap(sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [{\n              qTop: 0,\n              qLeft: 0,\n              qWidth: 3,\n              qHeight: 3333\n            }]));\n\n          case 5:\n            sessionData = _context18.sent;\n            return _context18.abrupt(\"return\", sessionData[0].qMatrix);\n\n          case 7:\n          case \"end\":\n            return _context18.stop();\n        }\n      }\n    }\n\n    return getAllSlideHeadersPlain$;\n  }(), null, this);\n}\n\n//\n// ─── GET LEVEL 1 TO 3 ────────────────────────────────────────────\n//\n//by default add extra slides (extra items in the data array), so you will get nice dynamic chapter breakers\nvar sectionBreakerConfig = true;\n\nfunction getAllSlides() {\n  var insertSectionBreakers,\n      qix,\n      table,\n      _args19 = arguments;\n  return _regenerator.default.async(function () {\n    function getAllSlides$(_context19) {\n      while (1) {\n        switch (_context19.prev = _context19.next) {\n          case 0:\n            insertSectionBreakers = _args19.length > 0 && _args19[0] !== undefined ? _args19[0] : sectionBreakerConfig;\n            _context19.next = 3;\n            return _regenerator.default.awrap(getSlideGenApp());\n\n          case 3:\n            qix = _context19.sent;\n            //insert breakers before a change of topic? YES/NO... breakers are annoying when you make a menu selection or want to link to a sheet\n            sectionBreakerConfig = insertSectionBreakers;\n\n            if (!insertSectionBreakers) {\n              _context19.next = 11;\n              break;\n            }\n\n            _context19.next = 8;\n            return _regenerator.default.awrap(getAllSlideHeaders(qix));\n\n          case 8:\n            _context19.t0 = _context19.sent;\n            _context19.next = 14;\n            break;\n\n          case 11:\n            _context19.next = 13;\n            return _regenerator.default.awrap(getAllSlideHeadersPlain(qix));\n\n          case 13:\n            _context19.t0 = _context19.sent;\n\n          case 14:\n            table = _context19.t0;\n            Session.set(\"slideHeaders\", table);\n\n          case 16:\n          case \"end\":\n            return _context19.stop();\n        }\n      }\n    }\n\n    return getAllSlides$;\n  }(), null, this);\n}\n\nfunction getComment(qix) {\n  var sessionModel;\n  return _regenerator.default.async(function () {\n    function getComment$(_context20) {\n      while (1) {\n        switch (_context20.prev = _context20.next) {\n          case 0:\n            _context20.next = 2;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"cube\"\n              },\n              qHyperCubeDef: {\n                qDimensions: [{\n                  qDef: {\n                    qFieldDefs: [\"Comment\"]\n                  }\n                }]\n              }\n            }));\n\n          case 2:\n            sessionModel = _context20.sent;\n            _context20.next = 5;\n            return _regenerator.default.awrap(sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [{\n              qTop: 0,\n              qLeft: 0,\n              qWidth: 3,\n              qHeight: 3333\n            }]));\n\n          case 5:\n            sessionData = _context20.sent;\n            Session.set(\"slideComment\", sessionData[0].qMatrix); // console.log('sessionModel', sessionModel)\n            // console.log('slide Comment', Session.get('slideComment'));\n\n          case 7:\n          case \"end\":\n            return _context20.stop();\n        }\n      }\n    }\n\n    return getComment$;\n  }(), null, this);\n}\n\nfunction setChangeListener(qix) {\n  return _regenerator.default.async(function () {\n    function setChangeListener$(_context22) {\n      while (1) {\n        switch (_context22.prev = _context22.next) {\n          case 0:\n            console.log('We are connected to Qlik Sense via the APIs, now setChangeListener', qix);\n\n            try {\n              qix.on(\"changed\", function () {\n                function _callee8() {\n                  return _regenerator.default.async(function () {\n                    function _callee8$(_context21) {\n                      while (1) {\n                        switch (_context21.prev = _context21.next) {\n                          case 0:\n                            _context21.next = 2;\n                            return _regenerator.default.awrap(getCurrentSelections());\n\n                          case 2:\n                          case \"end\":\n                            return _context21.stop();\n                        }\n                      }\n                    }\n\n                    return _callee8$;\n                  }(), null, this);\n                }\n\n                return _callee8;\n              }() // Session.set(\"slideHeaders\", null); //reset the slideheaders to ensure all slide content templates are re-rendered.\n              // Meteor.setTimeout(async function wait() {\n              //     await getAllSlides();\n              //     Reveal.slide(0); //go to the first slide after a data refresh.\n              // }, 100)\n              );\n            } catch (error) {\n              console.error(\"failed to set change listener: \", error);\n            }\n\n          case 2:\n          case \"end\":\n            return _context22.stop();\n        }\n      }\n    }\n\n    return setChangeListener$;\n  }(), null, this);\n}\n\nfunction insertSectionBreakers(table) {\n  var currentLevel1,\n      previousLevel1 = \"\";\n  var newTableWithChapter = [];\n  table.forEach(function (currentRow) {\n    var currentLevel1 = textOfLevel(currentRow, 1);\n\n    if (previousLevel1 !== currentLevel1) {\n      newTableWithChapter.push(currentLevel1);\n      previousLevel1 = currentLevel1;\n    }\n\n    newTableWithChapter.push(currentRow);\n  }); // console.log('table with chapters is', newTableWithChapter);\n\n  return newTableWithChapter;\n}\n\nfunction textOfLevel(row, level) {\n  level -= 1;\n  return row[level].qText;\n} //http://help.qlik.com/en-US/sense-developer/September2017/Subsystems/EngineAPI/Content/DiscoveringAndAnalysing/MakeSelections/get-current-selections.htm\n\n\nfunction getCurrentSelections() {\n  var qix, genericObject, layout, currentSelections, message;\n  return _regenerator.default.async(function () {\n    function getCurrentSelections$(_context23) {\n      while (1) {\n        switch (_context23.prev = _context23.next) {\n          case 0:\n            console.log('function: getCurrentSelections');\n            _context23.prev = 1;\n            _context23.next = 4;\n            return _regenerator.default.awrap(getSlideGenApp());\n\n          case 4:\n            qix = _context23.sent;\n            _context23.next = 7;\n            return _regenerator.default.awrap(qix.createSessionObject({\n              qInfo: {\n                qType: \"SessionLists\"\n              },\n              qSelectionObjectDef: {}\n            }));\n\n          case 7:\n            genericObject = _context23.sent;\n            console.log(\"sessionObject\", genericObject);\n            _context23.next = 11;\n            return _regenerator.default.awrap(genericObject.getLayout());\n\n          case 11:\n            layout = _context23.sent;\n            console.log('genericObject layout', layout);\n            currentSelections = layout.qSelectionObject.qSelections;\n            SenseSelections.insert({\n              userId: Meteor.userId,\n              userName: Meteor.user().profile.name,\n              eventType: \"selectionChanged\",\n              selection: currentSelections,\n              selectionDate: new Date() // current time\n\n            }, function (err, currentSelectionId) {\n              if (err) {\n                console.error(\"Failed to store the selection in mongoDb\");\n              }\n\n              Session.set(\"currentSelectionId\", currentSelectionId);\n              return currentSelections;\n            });\n            _context23.next = 21;\n            break;\n\n          case 17:\n            _context23.prev = 17;\n            _context23.t0 = _context23[\"catch\"](1);\n            message = \"getCurrentSelections: Can not connect to the Qlik Sense Engine API via enigmaJS\";\n            console.error(message, _context23.t0); // sAlert.error(message, error);\n\n          case 21:\n          case \"end\":\n            return _context23.stop();\n        }\n      }\n    }\n\n    return getCurrentSelections$;\n  }(), null, this, [[1, 17]]);\n}","map":{"version":3,"sources":["imports/ui/useCases/useCaseSelection.js"],"names":["module","export","initQlikSense","getSlideGenApp","getAllSlideHeaders","getSubjectArea","getLevel2","getLevel1","getAllSlideHeadersPlain","getAllSlides","getComment","setChangeListener","watch","require","nav","v","SenseSelections","Session","config","senseConfig","console","log","schema","enigma","Cookies","Reveal","qix","possibleRoles","makeSureSenseIsConnected","getTicket","ticket","ticketUrl","engineConfig","url","useSSL","host","Meteor","settings","public","qlikSensePortSecure","qlikSensePort","slideGenerator","virtualProxy","slideGeneratorAppId","session","create","on","res","params","severity","possibleEnigmaErr","message","data","method","mustAuthenticate","error","window","location","href","origin","name","open","global","openDoc","doc","id","enigmaError","sAlert","Tracker","autorun","get","setTimeout","slide","Template","useCaseSelection","onRendered","hasClass","el","className","classList","contains","RegExp","test","set","$","focus","dropdown","textToShow","w","d","document","onfocusin","undefined","addEventListener","addPolyfill","removePolyfill","e","type","event","CustomEvent","bubbles","cancelable","c1Generated","target","dispatchEvent","removeEventListener","menuItems1","querySelectorAll","Array","prototype","forEach","call","i","clearTimeout","timer1","opennav","querySelector","setAttribute","parentNode","preventDefault","links","timer2","events","t","Router","go","selectMenuItemInSense","selectedRole","getSlides","setSelectionInSense","field","value","clearAll","getField","myField","selectValues","qText","result","callPromise","group","helpers","userRole","headers","headersWithBreakers","insertSectionBreakers","createSessionObject","qInfo","qType","qHyperCubeDef","qDimensions","qDef","qFieldDefs","qSortCriterias","qSortByState","qSortByFrequency","qSortByNumeric","qSortByAscii","qSortByLoadOrder","qSortByExpression","qExpression","qv","qSortByGreyness","sessionModel","getHyperCubeData","qTop","qLeft","qWidth","qHeight","sessionData","qMatrix","qMeasures","qLabel","qLibraryId","qSortBy","sectionBreakerConfig","table","getCurrentSelections","currentLevel1","previousLevel1","newTableWithChapter","currentRow","textOfLevel","push","row","level","qSelectionObjectDef","genericObject","getLayout","layout","currentSelections","qSelectionObject","qSelections","insert","userId","userName","user","profile","eventType","selection","selectionDate","Date","err","currentSelectionId"],"mappings":"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","sourcesContent":["import \"/imports/ui/useCases/useCaseSelection.html\";\nimport \"/imports/ui/slideGenerator/slides.html\";\nimport \"/imports/ui/slideGenerator/slides\";\nimport \"/imports/ui/slideGenerator/slides.css\";\nimport * as nav from \"/imports/ui/nav.js\";\nimport { SenseSelections } from \"/imports/api/logger\";\nimport \"./SSBI/SSBI.js\";\nimport { Session } from \"meteor/session\";\nimport { senseConfig as config } from \"/imports/api/config.js\";\nconsole.log(\"🚀 ~ file: useCaseSelection.js:10 ~ config:\", config);\nconst schema = require(\"enigma.js/schemas/3.2.json\");\n\n// import {\n//     APILogs,\n//     REST_Log\n// } from '/imports/api/APILogs';\nconst enigma = require(\"enigma.js\");\n// const schema = require(\"enigma.js/schemas/12.20.0.json\");\nconst Cookies = require(\"js-cookie\");\nvar Reveal = require(\"reveal.js\");\nvar qix = null;\n\nvar possibleRoles = [\n  \"Developer\",\n  \"Hosting Ops\",\n  \"Business Analyst\",\n  \"CTO\",\n  \"C-Level - non-technical\",\n];\n\nexport async function initQlikSense() {\n  //connect to qlik sense\n  qix = await makeSureSenseIsConnected();\n  // make sure we get a signal if something changes in qlik sense, like a selection in the iframe menu\n  await setChangeListener(qix);\n}\n\nasync function makeSureSenseIsConnected() {\n  return await getSlideGenApp(await getTicket());\n}\nexport async function getSlideGenApp(ticket) {\n    var ticketUrl = ticket?\"?QlikTicket=\"+ticket:\"\";\n  const engineConfig = {\n    schema,\n    url: `${config.useSSL ? \"wss\" : \"ws\"}://${config.host}:${\n      config.useSSL\n        ? Meteor.settings.public.qlikSensePortSecure\n        : Meteor.settings.public.qlikSensePort}/${Meteor.settings.public.slideGenerator.virtualProxy}/app/${\n      config.slideGeneratorAppId}${ticketUrl}`,\n  };\n  try {\n    // create a new session:\n    const session = enigma.create(engineConfig);\n    // console.log(`Connecting to ${session.config.url}`);\n\n    //https://github.com/qlik-oss/enigma.js/blob/master/examples/basics/events/session.js\n    // bind traffic events to log what is sent and received on the socket:\n    // session.on(\"traffic:sent\", (data) => console.log(\"sent:\", data));\n    // session.on(\"traffic:received\", (data) => console.log(\"received:\", data));\n    // Catch possible errors sent on WebSocket\n    let possibleEnigmaErr;\n    session.on(\"traffic:received\", (res) => {\n      if (res.params && res.params.severity === \"fatal\") {\n        possibleEnigmaErr = res.params.message;\n      }\n    });\n\n    session.on('traffic:received', async (data)  => {\n        if (data.method === 'OnAuthenticationInformation' && data.params.mustAuthenticate === true) {\n            console.error('User is not authenticated... Redirect to root URL')\n            window.location.href = window.location.origin;\n        }\n      })\n      \n\n      session.on('notification:*', (name) => console.log(`Session: Notification event: ${name}`));\n    // open the socket and eventually receive the QIX global API, and then close\n    // the session:\n    \n\n    try {\n      var global = await session.open();\n    } catch (error) {\n      console.log(\"Error getting the global connection\", error);\n    }\n    try {\n      var doc = await global.openDoc(config.slideGeneratorAppId);\n      console.log(`********** User is authenticated and connected to the app, Session: Document id: ${doc.id}`);\n      return doc;\n    } catch (error) {\n      console.error(\"🚀 ~ file: useCaseSelection.js:68 ~ error:\", error);\n    }\n  } catch (error) {\n    if (error.enigmaError) {\n      console.error(\"Enigma error:\", possibleEnigmaErr || error);\n    } else {\n      console.error(\n        \"Qlik Sense Qix error, cannot make a websocket connection from the browser to Sense. \",\n        error\n      );\n    }\n    \n    sAlert.error(error.message);\n    // window.location.href = window.location.origin;\n  }\n}\n\n//make sure you go to the first slide when we have new slide data\nTracker.autorun(() => {\n  Session.get(\"slideHeaders\");\n  Meteor.setTimeout(function () {\n    try {\n      Reveal.slide(0);\n    } catch (error) {}\n  }, 500);\n});\n\n// ONRENDERED.\nTemplate.useCaseSelection.onRendered(async function () {\n  Session.set(\"showSelector\", false);\n  this.$(\"#flyoutnavkbfixed\").focus();\n\n  $(\".ui.dropdown\").dropdown(\"refresh\");\n  var textToShow = Cookies.get(\"currentMainRole\")\n    ? Cookies.get(\"currentMainRole\")\n    : \"Your role?\";\n  $(\".ui.dropdown\").dropdown(\"set selected\", textToShow);\n\n  !(function () {\n    var w = window,\n      d = w.document;\n\n    if (w.onfocusin === undefined) {\n      d.addEventListener(\"focus\", addPolyfill, true);\n      d.addEventListener(\"blur\", addPolyfill, true);\n      d.addEventListener(\"focusin\", removePolyfill, true);\n      d.addEventListener(\"focusout\", removePolyfill, true);\n    }\n    function addPolyfill(e) {\n      var type = e.type === \"focus\" ? \"focusin\" : \"focusout\";\n      var event = new CustomEvent(type, { bubbles: true, cancelable: false });\n      event.c1Generated = true;\n      e.target.dispatchEvent(event);\n    }\n    function removePolyfill(e) {\n      if (!e.c1Generated) {\n        // focus after focusin, so chrome will the first time trigger tow times focusin\n        d.removeEventListener(\"focus\", addPolyfill, true);\n        d.removeEventListener(\"blur\", addPolyfill, true);\n        d.removeEventListener(\"focusin\", removePolyfill, true);\n        d.removeEventListener(\"focusout\", removePolyfill, true);\n      }\n      setTimeout(function () {\n        d.removeEventListener(\"focusin\", removePolyfill, true);\n        d.removeEventListener(\"focusout\", removePolyfill, true);\n      });\n    }\n  })();\n\n  function hasClass(el, className) {\n    if (el.classList) {\n      return el.classList.contains(className);\n    } else {\n      return new RegExp(\"(^| )\" + className + \"( |$)\", \"gi\").test(el.className);\n    }\n  }\n\n  var menuItems1 = document.querySelectorAll(\n    \"#flyoutnavkbfixed li.has-submenu\"\n  );\n  var timer1, timer2;\n\n  Array.prototype.forEach.call(menuItems1, function (el, i) {\n    el.addEventListener(\"mouseover\", function (event) {\n      this.className = \"has-submenu open\";\n      clearTimeout(timer1);\n    });\n    el.addEventListener(\"mouseout\", function (event) {\n      timer1 = setTimeout(function (event) {\n        var opennav = document.querySelector(\n          \"#flyoutnavkbfixed .has-submenu.open\"\n        );\n        opennav.className = \"has-submenu\";\n        opennav.querySelector(\"a\").setAttribute(\"aria-expanded\", \"false\");\n      }, 1000);\n    });\n    el.querySelector(\"a\").addEventListener(\"click\", function (event) {\n      if (this.parentNode.className == \"has-submenu\") {\n        this.parentNode.className = \"has-submenu open\";\n        this.setAttribute(\"aria-expanded\", \"true\");\n      } else {\n        this.parentNode.className = \"has-submenu\";\n        this.setAttribute(\"aria-expanded\", \"false\");\n      }\n      event.preventDefault();\n    });\n    var links = el.querySelectorAll(\"a\");\n    Array.prototype.forEach.call(links, function (el, i) {\n      el.addEventListener(\"focus\", function () {\n        if (timer2) {\n          clearTimeout(timer2);\n          timer2 = null;\n        }\n      });\n      el.addEventListener(\"blur\", function (event) {\n        timer2 = setTimeout(function () {\n          var opennav = document.querySelector(\n            \"#flyoutnavkbfixed .has-submenu.open\"\n          );\n          if (opennav) {\n            opennav.className = \"has-submenu\";\n            opennav.querySelector(\"a\").setAttribute(\"aria-expanded\", \"false\");\n          }\n        }, 10);\n      });\n    });\n  });\n});\n\n//\n// ─── SLIDE GENERATOR BUTTON CLICK ─────────────────────────────────────────────────────────────────────\n//\n\nTemplate.useCaseSelection.events({\n  \"click .slides\": async function (e, t) {\n    Session.set(\"showSelector\", true);\n    Router.go(\"slides\");\n  },\n  \"click #CM\": async function (e, t) {\n    window.open(\"https://evaluation.qlik.com\", \"_blank\").focus();\n  },\n  \"click #videoButton\": async function (e, t) {\n    nav.selectMenuItemInSense(\"*Video overview:*\");\n  },\n  \"click #CM2SAAS\": async function (e, t) {\n    //if anaything happens with the dropdown box... adjust the selection, and get new slides.\n    var selectedRole = \"Client managed to SaaS\"; //e.currentTarget.id;\n    await getSlides(selectedRole);\n  },\n  \"click #SAAS\": async function (e, t) {\n    //if anaything happens with the dropdown box... adjust the selection, and get new slides.\n    var selectedRole = \"Qlik Cloud\"; //e.currentTarget.id;\n    await getSlides(selectedRole);\n  },\n});\n\nasync function getSlides(selectedRole) {\n  Cookies.set(\"currentMainRole\", selectedRole);\n  // await nav.makeClearAll(); already in set selection\n  await setSelectionInSense(\"Partial Workshop\", selectedRole);\n  //get slides\n  await getAllSlides();\n  Session.set(\"showSelector\", false);\n  Session.set(\"showSubjectAreaIntroduction\", true);\n\n  Router.go(\"slides\");\n  ////go to the first slide after a data refresh.\n  // Reveal.slide(0);\n}\n\nasync function setSelectionInSense(field, value) {\n  try {\n    var qix = await getSlideGenApp();\n    // console.log('qix', qix)\n    await qix.clearAll();\n    var myField = await qix.getField(field);\n    var result = await myField.selectValues([\n      {\n        qText: value,\n      },\n    ]);\n    // console.log('result of setting a selection in Sense', result)\n  } catch (error) {\n    console.error(\"Error making selection in Sense \", error);\n  }\n}\n\nasync function getTicket() {\n  try {\n    return await Meteor.callPromise(\n      \"getTicketNumber\",\n      { group: \"notProvided\" },\n      Meteor.settings.public.slideGenerator.virtualProxy\n    );\n  } catch (error) {\n    var message =\n      \"We could not setup single sing on with Qlik Sense. See your console window for more information\";\n    console.error(message, error);\n    sAlert.error(\n      \"Could not get a ticket in order to enforce SSO to Qlik Sense.\"\n    );\n  }\n}\n\n//HELPERS\nTemplate.useCaseSelection.helpers({\n  userRole() {\n    return Cookies.get(\"currentMainRole\");\n  },\n});\n\n//\n// ─── MAIN TOPICS LEVEL 1 AND 2 ─────────────────────────────────────────────────\n//\nexport async function getAllSlideHeaders(qix) {\n  //get all level 1 and 2 fields in a table: these are the individual slides (titles). The bullets are contained in level 3.\n  // return insertSectionBreakers(await getAllSlideHeadersPlain(qix));\n  var headers = await getAllSlideHeadersPlain(qix);\n  var headersWithBreakers = insertSectionBreakers(headers);\n  return headersWithBreakers;\n}\nexport async function getSubjectArea(qix) {\n  var sessionModel = await qix.createSessionObject({\n    qInfo: {\n      qType: \"cube\",\n    },\n    qHyperCubeDef: {\n      qDimensions: [\n        {\n          qDef: {\n            qFieldDefs: [\"Subject area\"],\n            qSortCriterias: [\n              {\n                qSortByState: 0,\n                qSortByFrequency: 0,\n                qSortByNumeric: 0,\n                qSortByAscii: 1,\n                qSortByLoadOrder: 0,\n                qSortByExpression: 0,\n                qExpression: {\n                  qv: \"max(CSVRowNo)\",\n                },\n                qSortByGreyness: 0,\n              },\n            ],\n          },\n        },\n      ],\n    },\n  });\n  sessionData = await sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [\n    {\n      qTop: 0,\n      qLeft: 0,\n      qWidth: 3,\n      qHeight: 3333,\n    },\n  ]);\n  console.log(\n    \"🚀 ~ file: useCaseSelection.js:322 ~ getSubjectArea ~ sessionData[0].qMatrix:\",\n    sessionData[0].qMatrix\n  );\n  return sessionData[0].qMatrix;\n}\n\nexport async function getLevel2(qix) {\n  var sessionModel = await qix.createSessionObject({\n    qInfo: {\n      qType: \"cube\",\n    },\n    qHyperCubeDef: {\n      qDimensions: [\n        {\n          qDef: {\n            qFieldDefs: [\"Level 2\"],\n          },\n        },\n      ],\n    },\n  });\n  sessionData = await sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [\n    {\n      qTop: 0,\n      qLeft: 0,\n      qWidth: 3,\n      qHeight: 3333,\n    },\n  ]);\n  return sessionData[0].qMatrix;\n}\n\nexport async function getLevel1(qix) {\n  //chapters\n  var sessionModel = await qix.createSessionObject({\n    qInfo: {\n      qType: \"cube\",\n    },\n    qHyperCubeDef: {\n      qDimensions: [\n        {\n          qDef: {\n            qFieldDefs: [\"Level 1\"],\n          },\n        },\n      ],\n      qMeasures: [\n        {\n          qDef: {\n            qDef: \"Sum({$< [Level 1]= > } 1)\",\n          },\n          qLabel: \"sum({1}1)\",\n          qLibraryId: null,\n          qSortBy: {\n            qSortByState: 0,\n            qSortByFrequency: 0,\n            qSortByNumeric: 0,\n            qSortByAscii: 0,\n            qSortByLoadOrder: 0,\n            qSortByExpression: 1,\n            qExpression: {\n              qv: \"min(CSVRowNo)\",\n            },\n          },\n        },\n      ],\n    },\n  });\n  sessionData = await sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [\n    {\n      qTop: 0,\n      qLeft: 0,\n      qWidth: 3,\n      qHeight: 3333,\n    },\n  ]);\n  return sessionData[0].qMatrix;\n  // return SortSenseData(sessionData[0].qMatrix);\n}\n\n// function SortSenseData(senseArray) {\n//     var result = [];\n//     senseArray.sort(compare);\n\n//     for (const element of senseArray) {\n//         result.push(element);\n//     }\n//     console.log(\"🚀  SortSenseData ~ result\", result)\n//     return result;\n// }\n\n// function compare(a, b) {\n//     if (a[1].qNum < b[1].qNum) {\n//         return -1;\n//     }\n//     if (a[1].qNum > b[1].qNum) {\n//         return 1;\n//     }\n//     return 0;\n// }\n\nexport async function getAllSlideHeadersPlain(qix) {\n  //get all level 1 and 2 fields in a table: these are the individual slides (titles). The bullets are contained in level 3.\n  var sessionModel = await qix.createSessionObject({\n    qInfo: {\n      qType: \"cube\",\n    },\n    qHyperCubeDef: {\n      qDimensions: [\n        {\n          qDef: {\n            qFieldDefs: [\"Level 1\"],\n          },\n        },\n        {\n          qDef: {\n            qFieldDefs: [\"Level 2\"],\n            qSortCriterias: [\n              {\n                qSortByState: 0,\n                qSortByFrequency: 0,\n                qSortByNumeric: 0,\n                qSortByAscii: 0,\n                qSortByLoadOrder: 1,\n                qSortByExpression: 1,\n                qExpression: {\n                  qv: \"min(CSVRowNo)\",\n                },\n                qSortByGreyness: 0,\n              },\n            ],\n          },\n        },\n      ],\n    },\n  });\n  sessionData = await sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [\n    {\n      qTop: 0,\n      qLeft: 0,\n      qWidth: 3,\n      qHeight: 3333,\n    },\n  ]);\n  return sessionData[0].qMatrix;\n}\n//\n// ─── GET LEVEL 1 TO 3 ────────────────────────────────────────────\n//\n//by default add extra slides (extra items in the data array), so you will get nice dynamic chapter breakers\nvar sectionBreakerConfig = true;\nexport async function getAllSlides(\n  insertSectionBreakers = sectionBreakerConfig\n) {\n  var qix = await getSlideGenApp();\n  //insert breakers before a change of topic? YES/NO... breakers are annoying when you make a menu selection or want to link to a sheet\n  sectionBreakerConfig = insertSectionBreakers;\n  var table = insertSectionBreakers\n    ? await getAllSlideHeaders(qix)\n    : await getAllSlideHeadersPlain(qix);\n  Session.set(\"slideHeaders\", table);\n}\n\nexport async function getComment(qix) {\n  var sessionModel = await qix.createSessionObject({\n    qInfo: {\n      qType: \"cube\",\n    },\n    qHyperCubeDef: {\n      qDimensions: [\n        {\n          qDef: {\n            qFieldDefs: [\"Comment\"],\n          },\n        },\n      ],\n    },\n  });\n  sessionData = await sessionModel.getHyperCubeData(\"/qHyperCubeDef\", [\n    {\n      qTop: 0,\n      qLeft: 0,\n      qWidth: 3,\n      qHeight: 3333,\n    },\n  ]);\n  Session.set(\"slideComment\", sessionData[0].qMatrix);\n  // console.log('sessionModel', sessionModel)\n  // console.log('slide Comment', Session.get('slideComment'));\n}\n\n//this code does not work since enigma v2...\nexport async function setChangeListener(qix) {\n  console.log('We are connected to Qlik Sense via the APIs, now setChangeListener', qix)\n    try {\n      qix.on(\"changed\", async () => {\n        // console.log('QIX instance change event received, so get the new data set out of Qlik Sense, and store the current selection in the database.');\n        await getCurrentSelections();\n        // Session.set(\"slideHeaders\", null); //reset the slideheaders to ensure all slide content templates are re-rendered.\n        // Meteor.setTimeout(async function wait() {\n        //     await getAllSlides();\n        //     Reveal.slide(0); //go to the first slide after a data refresh.\n        // }, 100)\n      });\n    } catch (error) {\n      console.error(\"failed to set change listener: \", error);\n    }\n}\n\nfunction insertSectionBreakers(table) {\n  var currentLevel1,\n    previousLevel1 = \"\";\n  var newTableWithChapter = [];\n\n  table.forEach(function (currentRow) {\n    var currentLevel1 = textOfLevel(currentRow, 1);\n    if (previousLevel1 !== currentLevel1) {\n      newTableWithChapter.push(currentLevel1);\n      previousLevel1 = currentLevel1;\n    }\n    newTableWithChapter.push(currentRow);\n  });\n  // console.log('table with chapters is', newTableWithChapter);\n  return newTableWithChapter;\n}\n\nfunction textOfLevel(row, level) {\n  level -= 1;\n  return row[level].qText;\n}\n\n//http://help.qlik.com/en-US/sense-developer/September2017/Subsystems/EngineAPI/Content/DiscoveringAndAnalysing/MakeSelections/get-current-selections.htm\nasync function getCurrentSelections() {\n  console.log('function: getCurrentSelections');\n  try {\n    var qix = await getSlideGenApp();\n    var genericObject = await qix.createSessionObject({\n      qInfo: {\n        qType: \"SessionLists\",\n      },\n      qSelectionObjectDef: {},\n    });\n    console.log(\"sessionObject\", genericObject);\n\n    var layout = await genericObject.getLayout();\n    console.log('genericObject layout', layout)\n    var currentSelections = layout.qSelectionObject.qSelections;\n    SenseSelections.insert(\n      {\n        userId: Meteor.userId,\n        userName: Meteor.user().profile.name,\n        eventType: \"selectionChanged\",\n        selection: currentSelections,\n        selectionDate: new Date(), // current time\n      },\n      function (err, currentSelectionId) {\n        if (err) {\n          console.error(\"Failed to store the selection in mongoDb\");\n        }\n        Session.set(\"currentSelectionId\", currentSelectionId);\n        return currentSelections;\n      }\n    );\n  } catch (error) {\n    var message =\n      \"getCurrentSelections: Can not connect to the Qlik Sense Engine API via enigmaJS\";\n    console.error(message, error);\n    // sAlert.error(message, error);\n  }\n}\n"]},"sourceType":"script","hash":"c8920f75c08dc7a43c52b0145b29fa40eab1c88c"}
