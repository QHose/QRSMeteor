{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/ui/generation/OEMPartnerSide/OEMPartner.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/generation/OEMPartnerSide/OEMPartner.js","filename":"imports/ui/generation/OEMPartnerSide/OEMPartner.js","sourceMaps":true,"passPerPreset":false,"envName":"development","cwd":"/home/martijn/Documents/GitHub/QRSMeteor","root":"/home/martijn/Documents/GitHub/QRSMeteor","generatorOpts":{"filename":"imports/ui/generation/OEMPartnerSide/OEMPartner.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/generation/OEMPartnerSide/OEMPartner.js"}},"code":"module.export({\n  insertTemplateAndDummyCustomers: function () {\n    return insertTemplateAndDummyCustomers;\n  }\n});\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 0);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar senseConfig;\nmodule.watch(require(\"/imports/api/config.js\"), {\n  senseConfig: function (v) {\n    senseConfig = v;\n  }\n}, 2);\nvar Apps, TemplateApps, GeneratedResources;\nmodule.watch(require(\"/imports/api/apps.js\"), {\n  Apps: function (v) {\n    Apps = v;\n  },\n  TemplateApps: function (v) {\n    TemplateApps = v;\n  },\n  GeneratedResources: function (v) {\n    GeneratedResources = v;\n  }\n}, 3);\nvar Customers, dummyCustomers;\nmodule.watch(require(\"/imports/api/customers.js\"), {\n  Customers: function (v) {\n    Customers = v;\n  },\n  dummyCustomers: function (v) {\n    dummyCustomers = v;\n  }\n}, 4);\nvar Streams;\nmodule.watch(require(\"/imports/api/streams.js\"), {\n  Streams: function (v) {\n    Streams = v;\n  }\n}, 5);\nvar APILogs;\nmodule.watch(require(\"/imports/api/APILogs\"), {\n  APILogs: function (v) {\n    APILogs = v;\n  }\n}, 6);\nvar freshEnvironment;\nmodule.watch(require(\"/imports/ui/UIHelpers\"), {\n  freshEnvironment: function (v) {\n    freshEnvironment = v;\n  }\n}, 7);\nmodule.watch(require(\"./OEMPartner.html\"));\nmodule.watch(require(\"./customerOverview.js\"));\nmodule.watch(require(\"./simulateUserLogin.js\"));\nmodule.watch(require(\"./step2\"));\nmodule.watch(require(\"./step3\"));\nmodule.watch(require(\"./step4\"));\nmodule.watch(require(\"./mainButtons\"));\nvar lodash;\nmodule.watch(require(\"lodash\"), {\n  \"default\": function (v) {\n    lodash = v;\n  }\n}, 8);\n_ = lodash;\nTemplate.OEMPartner.helpers({\n  linkToApp: function () {\n    return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/sense/app/' + this.id;\n  },\n  RESTCallSettings: function () {\n    return {\n      rowsPerPage: 6,\n      responsive: true,\n      autoWidth: false,\n      showFilter: false,\n      showNavigation: 'never',\n      showColumnToggles: false,\n      fields: [{\n        key: 'action',\n        label: 'Activities that are currently being executed via API calls'\n      }, // {\n      //     key: 'request',\n      //     label: 'Request',\n      //     cellClass: \"overflow: hidden; text - overflow: ellipsis\"\n      // },\n      {\n        key: 'createDate',\n        hidden: true,\n        label: 'Create Date',\n        sortOrder: 0,\n        sortDirection: 'descending'\n      }]\n    };\n  },\n  restrictedApiLogs: function () {\n    return APILogs.find({}, {\n      fields: {\n        'response.content': 0\n      }\n    });\n  }\n});\nTemplate.OEMPartner.events({\n  'submit .new-customer': function (event) {\n    // Prevent default browser form submit\n    event.preventDefault(); // Get value from form element\n\n    var target = event.target;\n    var customerName = target.text.value; // Insert a task into the collection\n\n    Customers.insert({\n      name: customerName,\n      checked: true,\n      createdAt: new Date(),\n      // current time\n      createdBy: Meteor.user()\n    }); // Clear form\n\n    target.text.value = '';\n  },\n  'click .resetEnvironment': function () {\n    Session.set('loadingIndicator', 'loading');\n    Meteor.call('resetEnvironment', function (err, res) {\n      if (err) {\n        sAlert.error(err);\n        console.log(err);\n        Session.set('loadingIndicator', '');\n      } else {\n        Session.set('loadingIndicator', '');\n        Session.set('currentUser', null); // sAlert.success(\"Qlik Sense has been cleaned up: we have removed all previously provisioned streams and apps\");\n      }\n    });\n    Session.set('currentStep', 0);\n    Session.set('generated?', false); // Session.set('goToSt', false);\n  },\n  'click .generateStreamAndApp': function () {\n    Session.set('loadingIndicator', 'loading');\n    var selectedCustomers = Customers.find({\n      generationUserId: Meteor.userId(),\n      checked: true\n    }).fetch();\n    Meteor.call('generateStreamAndApp', selectedCustomers, function (err, result) {\n      if (err) {\n        sAlert.error(err);\n        console.log(err);\n        Session.set('loadingIndicator', '');\n        Session.setAuth('generated?', false);\n      } else {\n        Session.set('loadingIndicator', '');\n        Session.setAuth('generated?', true);\n        Session.setAuth('currentStep', 4);\n        console.log('generateStreamAndApp succes', result); // sAlert.success('We have created \"a copy\" of the template app for each customer. And to group the apps, we created a stream with the name of the customer');\n      }\n    });\n  },\n  'click .insertDummyCustomers': function (event) {\n    event.preventDefault();\n    insertTemplateAndDummyCustomers(); // sAlert.success('We have pre-selected some fictitious customers. Which apps will you provide your customers?');\n\n    Session.setAuth('currentStep', 2);\n  },\n  'click .goToStep3': function (event) {\n    if (TemplateApps.find().count()) {\n      Session.setAuth('currentStep', 3); // sAlert.success('We have now selected the customers and the apps they need. Now press start to create the apps in Qlik Sense');\n    } else {\n      sAlert.error('Please select at least one template');\n    }\n  }\n}); //end Meteor events\n\nfunction insertTemplateAndDummyCustomers() {\n  _.each(dummyCustomers, function (customer) {\n    customer.generationUserId = Meteor.userId();\n    Customers.insert(customer);\n  }); // const templateAppId = Meteor.settings.public.templateAppId;\n  // console.log('Insert insertTemplateAndDummyCustomers, with templateAppId', templateAppId);\n  // TemplateApps.insert({\n  //     name: \"My first template\",\n  //     id: templateAppId,\n  //     generationUserId: Meteor.userId(),\n  //     checked: true\n  // });\n\n}\n\n// Template.OEMPartner.onCreated(function() {\n//     //see https://guide.meteor.com/data-loading.html\n//     const templateAppsHandle = Meteor.subscribe('templateApps');\n//     const apiLogsHandle = Meteor.subscribe('apiLogs');\n//     const customersHandle = Meteor.subscribe('customers', { //http://stackoverflow.com/questions/28621132/meteor-subscribe-callback\n//         onReady: function() {\n//             // if (freshEnvironment()) {\n//             //     console.log('There is a freshEnvironment');\n//             //     insertTemplateAndDummyCustomers()\n//             //     Session.setAuth('currentStep', 3);\n//             // };\n//         },\n//         onError: function() { console.log(\"onError\", arguments); }\n//     });\n// });\nTemplate.OEMPartner.onRendered(function () {\n  Template.instance().$('.ui.embed').embed();\n});\nTemplate.templateCheckBox.onRendered(function () {\n  Template.instance().$('.ui.toggle.checkbox').checkbox();\n});","map":{"version":3,"sources":["imports/ui/generation/OEMPartnerSide/OEMPartner.js"],"names":["module","export","insertTemplateAndDummyCustomers","Template","watch","require","v","Meteor","senseConfig","Apps","TemplateApps","GeneratedResources","Customers","dummyCustomers","Streams","APILogs","freshEnvironment","lodash","_","OEMPartner","helpers","linkToApp","host","port","virtualProxyClientUsage","id","RESTCallSettings","rowsPerPage","responsive","autoWidth","showFilter","showNavigation","showColumnToggles","fields","key","label","hidden","sortOrder","sortDirection","restrictedApiLogs","find","events","event","preventDefault","target","customerName","text","value","insert","name","checked","createdAt","Date","createdBy","user","Session","set","call","err","res","sAlert","error","console","log","selectedCustomers","generationUserId","userId","fetch","result","setAuth","count","each","customer","onRendered","instance","$","embed","templateCheckBox","checkbox"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport { Meteor } from 'meteor/meteor';\nimport { senseConfig } from '/imports/api/config.js';\nimport { Apps, TemplateApps, GeneratedResources } from '/imports/api/apps.js'\nimport { Customers, dummyCustomers } from '/imports/api/customers.js';\nimport { Streams } from '/imports/api/streams.js'\nimport { APILogs } from '/imports/api/APILogs';\nimport { freshEnvironment } from '/imports/ui/UIHelpers';\n\nimport './OEMPartner.html';\nimport './customerOverview.js';\nimport './simulateUserLogin.js';\nimport './step2';\nimport './step3';\nimport './step4';\nimport './mainButtons';\n\nimport lodash from 'lodash';\n_ = lodash;\n\n\n\nTemplate.OEMPartner.helpers({\n    linkToApp() {\n        return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/sense/app/' + this.id\n    },\n    RESTCallSettings: function() {\n        return {\n            rowsPerPage: 6,\n            responsive: true,\n            autoWidth: false,\n            showFilter: false,\n            showNavigation: 'never',\n            showColumnToggles: false,\n            fields: [{\n                    key: 'action',\n                    label: 'Activities that are currently being executed via API calls'\n                },\n                // {\n                //     key: 'request',\n                //     label: 'Request',\n                //     cellClass: \"overflow: hidden; text - overflow: ellipsis\"\n                // },\n                {\n                    key: 'createDate',\n                    hidden: true,\n                    label: 'Create Date',\n                    sortOrder: 0,\n                    sortDirection: 'descending'\n                }\n            ]\n        };\n    },\n    restrictedApiLogs: function() {\n        return APILogs.find({}, { fields: { 'response.content': 0 } });\n    }\n});\n\n\nTemplate.OEMPartner.events({\n    'submit .new-customer' (event) {\n        // Prevent default browser form submit\n        event.preventDefault();\n        // Get value from form element\n        const target = event.target;\n        const customerName = target.text.value;\n        // Insert a task into the collection\n        Customers.insert({\n            name: customerName,\n            checked: true,\n            createdAt: new Date(), // current time\n            createdBy: Meteor.user()\n        });\n        // Clear form\n        target.text.value = '';\n    },\n    'click .resetEnvironment' () {\n        Session.set('loadingIndicator', 'loading');\n        Meteor.call('resetEnvironment', function(err, res) {\n            if (err) {\n                sAlert.error(err);\n                console.log(err);\n                Session.set('loadingIndicator', '');\n            } else {\n                Session.set('loadingIndicator', '');\n                Session.set('currentUser', null);\n                // sAlert.success(\"Qlik Sense has been cleaned up: we have removed all previously provisioned streams and apps\");\n            }\n        });\n        Session.set('currentStep', 0);\n        Session.set('generated?', false);\n        // Session.set('goToSt', false);\n    },\n    'click .generateStreamAndApp' () {\n        Session.set('loadingIndicator', 'loading');\n\n        var selectedCustomers = Customers.find({ generationUserId: Meteor.userId(), checked: true })\n            .fetch();\n\n        Meteor.call('generateStreamAndApp', selectedCustomers, function(err, result) {\n            if (err) {\n                sAlert.error(err);\n                console.log(err);\n                Session.set('loadingIndicator', '');\n                Session.setAuth('generated?', false);\n            } else {\n                Session.set('loadingIndicator', '');\n                Session.setAuth('generated?', true);\n                Session.setAuth('currentStep', 4);\n                console.log('generateStreamAndApp succes', result);\n                // sAlert.success('We have created \"a copy\" of the template app for each customer. And to group the apps, we created a stream with the name of the customer');\n            }\n        });\n    },\n    'click .insertDummyCustomers' (event) {\n        event.preventDefault();\n        insertTemplateAndDummyCustomers();\n        // sAlert.success('We have pre-selected some fictitious customers. Which apps will you provide your customers?');\n        Session.setAuth('currentStep', 2);\n    },\n    'click .goToStep3' (event) {\n        if (TemplateApps.find().count()) {\n            Session.setAuth('currentStep', 3);\n            // sAlert.success('We have now selected the customers and the apps they need. Now press start to create the apps in Qlik Sense');\n        } else {\n            sAlert.error('Please select at least one template');\n        }\n    },\n\n}); //end Meteor events\n\n\nexport function insertTemplateAndDummyCustomers() {\n\n    _.each(dummyCustomers, function(customer) {\n        customer.generationUserId = Meteor.userId();\n        Customers.insert(customer);\n    })\n\n    // const templateAppId = Meteor.settings.public.templateAppId;\n    // console.log('Insert insertTemplateAndDummyCustomers, with templateAppId', templateAppId);\n\n\n    // TemplateApps.insert({\n    //     name: \"My first template\",\n    //     id: templateAppId,\n    //     generationUserId: Meteor.userId(),\n    //     checked: true\n    // });\n\n}\n\n\n// Template.OEMPartner.onCreated(function() {\n//     //see https://guide.meteor.com/data-loading.html\n//     const templateAppsHandle = Meteor.subscribe('templateApps');\n//     const apiLogsHandle = Meteor.subscribe('apiLogs');\n//     const customersHandle = Meteor.subscribe('customers', { //http://stackoverflow.com/questions/28621132/meteor-subscribe-callback\n//         onReady: function() {\n//             // if (freshEnvironment()) {\n//             //     console.log('There is a freshEnvironment');\n//             //     insertTemplateAndDummyCustomers()\n//             //     Session.setAuth('currentStep', 3);\n//             // };\n//         },\n//         onError: function() { console.log(\"onError\", arguments); }\n//     });\n// });\n\nTemplate.OEMPartner.onRendered(function() {\n    Template.instance()\n        .$('.ui.embed')\n        .embed();\n})\n\n\nTemplate.templateCheckBox.onRendered(function() {\n    Template.instance()\n        .$('.ui.toggle.checkbox')\n        .checkbox();\n})"]},"sourceType":"script","hash":"e036deccdf445f1b78011d0d0fa2247a56a3d708"}
