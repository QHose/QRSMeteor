{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/api/server/QRSFunctionsSystemRules.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/server/QRSFunctionsSystemRules.js","filename":"imports/api/server/QRSFunctionsSystemRules.js","sourceMaps":true,"passPerPreset":false,"envName":"development","cwd":"/home/martijn/Documents/GitHub/QRSMeteor","root":"/home/martijn/Documents/GitHub/QRSMeteor","presets":[],"generatorOpts":{"filename":"imports/api/server/QRSFunctionsSystemRules.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/server/QRSFunctionsSystemRules.js"}},"code":"module.export({\n  getSecurityRules: () => getSecurityRules,\n  disableDefaultSecurityRules: () => disableDefaultSecurityRules,\n  createSecurityRules: () => createSecurityRules\n});\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet qrs, validateJSON;\nmodule.watch(require(\"/imports/api/config.js\"), {\n  qrs(v) {\n    qrs = v;\n  },\n\n  validateJSON(v) {\n    validateJSON = v;\n  }\n\n}, 1);\nlet QSLic;\nmodule.watch(require(\"/imports/api/server/QRSFunctionsLicense\"), {\n  \"*\"(v) {\n    QSLic = v;\n  }\n\n}, 2);\n\n// import { APILogs } from '/imports/api/APILogs';\nvar fs = require('fs-extra');\n\nconst path = require('path');\n\nfunction getSecurityRules(name) {\n  return QSLic.getSystemRules(name);\n}\n\nfunction disableDefaultSecurityRules() {\n  console.log('------------------------------------');\n  console.log('disable Default SecurityRules');\n  console.log('------------------------------------');\n\n  for (let ruleName of Meteor.settings.security.rulesToDisable) {\n    console.log('From Meteor.settings.security.rulesToDisable, Disable security rule: ', ruleName);\n    var ruleDefinition = QSLic.getSystemRules(ruleName)[0];\n\n    if (ruleDefinition) {\n      ruleDefinition.disabled = true;\n      var response = qrs.put('/qrs/SystemRule/' + ruleDefinition.id, null, ruleDefinition);\n    } else {\n      console.warn('The system rule does not exist in Sense: ' + ruleName);\n    }\n  }\n\n  ;\n}\n\nfunction createSecurityRules() {\n  return Promise.asyncApply(() => {\n    console.log('------------------------------------');\n    console.log('create security rules in Qlik Sense based on import file');\n    console.log('------------------------------------');\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'securityrules', 'import', 'securityRuleSettings.json'); // READ THE FILE \n\n    var securityRules = Promise.await(fs.readJson(file));\n\n    try {\n      validateJSON(securityRules);\n    } catch (err) {\n      throw new Error('Cant read the security rule definitions file: ' + file);\n    }\n\n    securityRules.forEach(function (rule) {\n      //check if the rule already exists in Sense\n      if (!QSLic.getSystemRules(rule.name).length) {\n        //if not exist, create it\n        var response = qrs.post('/qrs/SystemRule', null, rule);\n      } else {\n        console.log('Security rule \"' + rule.name + '\" already existed');\n      }\n    });\n  });\n}\n\nfunction stringToJSON(myString) {\n  var myJSONString = JSON.stringify(myString);\n  var myEscapedJSONString = myJSONString.replace(/\\\\n/g, \"\\\\n\").replace(/\\\\'/g, \"\\\\'\").replace(/\\\\\"/g, '\\\\\"').replace(/\\\\&/g, \"\\\\&\").replace(/\\\\r/g, \"\\\\r\").replace(/\\\\t/g, \"\\\\t\").replace(/\\\\b/g, \"\\\\b\").replace(/\\\\f/g, \"\\\\f\");\n  console.log('myEscapedJSONString', myEscapedJSONString);\n}","map":{"version":3,"sources":["imports/api/server/QRSFunctionsSystemRules.js"],"names":["module","export","getSecurityRules","disableDefaultSecurityRules","createSecurityRules","Meteor","watch","require","v","qrs","validateJSON","QSLic","fs","path","name","getSystemRules","console","log","ruleName","settings","security","rulesToDisable","ruleDefinition","disabled","response","put","id","warn","file","join","broker","automationBaseFolder","securityRules","readJson","err","Error","forEach","rule","length","post","stringToJSON","myString","myJSONString","JSON","stringify","myEscapedJSONString","replace"],"mappings":"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","sourcesContent":["import {\n    Meteor\n} from 'meteor/meteor';\n// import { APILogs } from '/imports/api/APILogs';\nvar fs = require('fs-extra');\nconst path = require('path');\n\nimport {\n    qrs,\n    validateJSON\n} from '/imports/api/config.js';\nimport * as QSLic from '/imports/api/server/QRSFunctionsLicense';\n\nexport function getSecurityRules(name) {\n    return QSLic.getSystemRules(name);\n}\n\nexport function disableDefaultSecurityRules() {\n    console.log('------------------------------------');\n    console.log('disable Default SecurityRules')\n    console.log('------------------------------------');\n\n    for (let ruleName of Meteor.settings.security.rulesToDisable) {\n        console.log('From Meteor.settings.security.rulesToDisable, Disable security rule: ', ruleName)\n\n        var ruleDefinition = QSLic.getSystemRules(ruleName)[0];\n        if (ruleDefinition) {\n            ruleDefinition.disabled = true;\n            var response = qrs.put('/qrs/SystemRule/' + ruleDefinition.id, null, ruleDefinition);\n        } else {\n            console.warn('The system rule does not exist in Sense: ' + ruleName);\n        }\n    };\n}\n\nexport async function createSecurityRules() {\n    console.log('------------------------------------');\n    console.log('create security rules in Qlik Sense based on import file');\n    console.log('------------------------------------');\n\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'securityrules', 'import', 'securityRuleSettings.json');\n\n    // READ THE FILE \n    var securityRules = await fs.readJson(file);\n    try {\n        validateJSON(securityRules)\n    } catch (err) {\n        throw new Error('Cant read the security rule definitions file: ' + file);\n    }\n\n    securityRules.forEach(function(rule) {\n        //check if the rule already exists in Sense\n        if (!QSLic.getSystemRules(rule.name).length) {\n            //if not exist, create it\n            var response = qrs.post('/qrs/SystemRule', null, rule);\n        } else {\n            console.log('Security rule \"' + rule.name + '\" already existed');\n        }\n    });\n}\n\nfunction stringToJSON(myString) {\n    var myJSONString = JSON.stringify(myString);\n    var myEscapedJSONString = myJSONString.replace(/\\\\n/g, \"\\\\n\")\n        .replace(/\\\\'/g, \"\\\\'\")\n        .replace(/\\\\\"/g, '\\\\\"')\n        .replace(/\\\\&/g, \"\\\\&\")\n        .replace(/\\\\r/g, \"\\\\r\")\n        .replace(/\\\\t/g, \"\\\\t\")\n        .replace(/\\\\b/g, \"\\\\b\")\n        .replace(/\\\\f/g, \"\\\\f\");\n\n    console.log('myEscapedJSONString', myEscapedJSONString)\n}"]},"sourceType":"script","hash":"c897e81bf56296f3153bac2fd797e759ab20debd"}
