{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/ui/generation/generation.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/generation/generation.js","filename":"imports/ui/generation/generation.js","sourceMaps":true,"passPerPreset":false,"envName":"development","cwd":"/home/martijn/Documents/GitHub/QRSMeteor","root":"/home/martijn/Documents/GitHub/QRSMeteor","presets":[],"generatorOpts":{"filename":"imports/ui/generation/generation.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/generation/generation.js"}},"code":"module.export({\n  updateSenseInfo: () => updateSenseInfo\n});\nlet Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template(v) {\n    Template = v;\n  }\n\n}, 0);\nlet Customers, dummyCustomers;\nmodule.watch(require(\"/imports/api/customers\"), {\n  Customers(v) {\n    Customers = v;\n  },\n\n  dummyCustomers(v) {\n    dummyCustomers = v;\n  }\n\n}, 1);\nlet Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session(v) {\n    Session = v;\n  }\n\n}, 2);\nlet config;\nmodule.watch(require(\"/imports/api/config\"), {\n  senseConfig(v) {\n    config = v;\n  }\n\n}, 3);\nmodule.watch(require(\"/imports/ui/UIHelpers\"));\nmodule.watch(require(\"./generation.html\"));\nmodule.watch(require(\"./steps.js\"));\nlet Apps, TemplateApps, GeneratedResources;\nmodule.watch(require(\"/imports/api/apps\"), {\n  Apps(v) {\n    Apps = v;\n  },\n\n  TemplateApps(v) {\n    TemplateApps = v;\n  },\n\n  GeneratedResources(v) {\n    GeneratedResources = v;\n  }\n\n}, 4);\nlet APILogs;\nmodule.watch(require(\"/imports/api/APILogs\"), {\n  APILogs(v) {\n    APILogs = v;\n  }\n\n}, 5);\nlet Streams;\nmodule.watch(require(\"/imports/api/streams\"), {\n  Streams(v) {\n    Streams = v;\n  }\n\n}, 6);\nmodule.watch(require(\"./customer\"));\nmodule.watch(require(\"./OEMPartnerSide/OEMPartner\"));\nlet moment;\nmodule.watch(require(\"moment\"), {\n  default(v) {\n    moment = v;\n  }\n\n}, 7);\nTemplate.generationApps.helpers({\n  countApps() {\n    return Apps.find().count();\n  },\n\n  appSettings: function () {\n    // console.log('client generation helper: get app table, the config used to generate the URLs to Sense: ', config);\n    return {\n      collection: Apps,\n      rowsPerPage: 5,\n      showFilter: true,\n      showColumnToggles: true,\n      // fields: ['customer', 'telephone', 'email', 'status', 'itemCount', 'deliveryDate', 'remarks'],\n      fields: [{\n        key: 'name',\n        label: 'App',\n        fn: function (value, object, key) {\n          if (Session.get('currentStep') === 4 && Session.get('currentUser')) {\n            return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/sense/app/' + object.id + ' target=\"_blank\">' + value + '</a>');\n          } else {\n            return object.name;\n          }\n        }\n      }, {\n        key: 'id',\n        label: 'Guid',\n        hidden: true,\n        fn: function (value) {\n          return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/sense/app/' + value + ' target=\"_blank\">' + value + '</a>');\n        }\n      }, {\n        key: 'description',\n        label: 'description',\n        hidden: true\n      }, {\n        key: 'modifiedDate',\n        label: 'ModifiedDate',\n        hidden: true,\n        fn: function (value) {\n          return moment(value).format('DD-MM-YYYY');\n        }\n      }, {\n        key: 'stream.name',\n        label: 'Stream',\n        sortOrder: 1,\n        fn: function (value, object) {\n          return value;\n        }\n      }, {\n        key: 'published',\n        label: 'Published',\n        hidden: true\n      }, {\n        key: 'lastReloadTime',\n        label: 'Last reload',\n        hidden: true,\n        fn: function (value) {\n          return moment(value).format('MMMM Do YYYY, h:mm:ss a');\n        }\n      }, {\n        key: 'fileSize',\n        label: 'File size',\n        hidden: true,\n        fn: function (value) {\n          return value / 1000000;\n        }\n      }]\n    };\n  }\n});\nTemplate.generationStreams.helpers({\n  countStreams() {\n    return Streams.find().count();\n  },\n\n  streamSettings: function () {\n    return {\n      collection: Streams,\n      rowsPerPage: 5,\n      showFilter: true,\n      showColumnToggles: true,\n      fields: [{\n        key: 'name',\n        label: 'Stream',\n        fn: function (value, object, key) {\n          if (Session.get('currentStep') === 4 && Session.get('currentUser')) {\n            return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/hub/stream/' + object.id + ' target=\"_blank\">' + value + '</a>');\n          } else {\n            return object.name;\n          }\n        }\n      }, // { key: 'id', label: 'Guid' }, \n      {\n        key: 'id',\n        label: 'Guid',\n        hidden: true\n      }, {\n        key: 'createdDate',\n        label: 'Created date',\n        hidden: true,\n        fn: function (value, object) {\n          return moment(value).format('DD-MM-YYYY');\n        }\n      }]\n    };\n  }\n});\nTemplate.generation.events({\n  'click .reactive-table tbody tr': function (event) {\n    var currentApp = this;\n    console.log(event); // if (event.target.className == \"markAsTemplate\") {\n    //     console.log('markAsTemplate app clicked: ' + currentApp.name);\n    //     TemplateApps.upsert(currentApp._id, {\n    //         $set: {\n    //             name: currentApp.name,\n    //             id: currentApp.id,\n    //             generationUserId: Meteor.userId(),\n    //             checked: !this.checked\n    //         },\n    //     });\n    // }\n    //Copy APP\n\n    if (event.target.className === \"copyApp\") {\n      console.log('Copy app clicked: ' + currentApp.name);\n      Meteor.call('copyAppSelectedCustomers', currentApp, (error, result) => {\n        //contains QVF guid of the current iteration over the apps  \n        if (error) {\n          sAlert.error(error);\n        } else {// sAlert.success(\"QVF '\" + currentApp.name + \" copied in Qlik Sense via the QRS API for each of the selected customers\");\n        }\n      }); //method call \n    } //DELETE APP\n\n\n    if (event.target.className === \"deleteApp\") {\n      console.log('delete app clicked: ' + currentApp.name);\n      Meteor.call('deleteApp', this.id, (error, result) => {\n        if (error) {\n          sAlert.error(error);\n          console.log(error);\n        } else {\n          console.log('app removed'); // sAlert.success(\"APP \" + currentApp.name + \" deleted in Qlik Sense via the QRS API\");\n        }\n      }); //method call \n    } //end if delete button is clicked \n    //DELETE Stream\n\n\n    if (event.target.className == \"deleteStream\") {\n      var currentStream = this;\n      console.log('delete stream clicked: ' + currentStream.name);\n      Meteor.call('deleteStream', this.id, (error, result) => {\n        if (error) {\n          sAlert.error(error);\n          console.log(error);\n        } else {\n          console.log('Stream removed'); // sAlert.success('Stream: ' + currentStream.name + \" deleted in Qlik Sense via the QRS API\");\n        }\n      }); //method call \n    } //delete stream event target\n\n  } //'click .reactive-table tbody tr        \n\n}); //end Meteor events\n\nvar updateSenseInfo = function () {\n  Meteor.call('updateLocalSenseCopy');\n};\n\n//this code gets executed if the page has been loaded, so a good moment to Connect to Sense a get the most recent apps and streams\nTemplate.generation.onRendered(function () {\n  if (!Session.get('currentStep')) {\n    Session.set('currentStep', 1);\n  }\n\n  updateSenseInfo();\n  console.log('generated onRendered: Check if we have a connection to Sense?'); // $('.dimmer')\n  //     .dimmer('show');\n\n  Meteor.call('getStreams', (error, result) => {\n    if (error) {\n      console.error(error);\n      Session.set('NoSenseConnection', true);\n      sAlert.error(\"We can't connect to Qlik Sense, is your Sense VM running, all services started?, virtual proxy 'hdr' configured? Did you export the certificates and referred to them in the settings-XYZ.json in your project root? Also check the host/port (Qlik Sense) settings. Make sure you check the problem solving chapters in the installation manual (documentation-generic tab).\");\n    } else {\n      var message = \"Connected to Qlik Sense via the REST and websocket APIs. We registered a QRS notification event to ensure this MeteorJs platform automatically updates when Qlik Sense changes.\"; // console.log(message);\n      // sAlert.success(message);\n\n      Session.set('NoSenseConnection', false);\n    }\n  });\n});\nTemplate.QlikSense.onRendered(function () {\n  this.$('.ui.accordion').accordion();\n});\nTemplate.generation.onCreated(function () {\n  //see https://guide.meteor.com/data-loading.html\n  this.subscribe('streams');\n  this.subscribe('customers');\n  const templateAppsHandle = Meteor.subscribe('templateApps');\n  const apiLogsHandle = Meteor.subscribe('apiLogs');\n  const customersHandle = Meteor.subscribe('customers', {\n    //http://stackoverflow.com/questions/28621132/meteor-subscribe-callback\n    onReady: function () {},\n    onError: function () {\n      console.log(\"onError\", arguments);\n    }\n  });\n  var self = this;\n  self.autorun(function () {\n    self.subscribe('generatedResources', function () {\n      // console.log('generatedResources changed, so update the apps subscription');\n      Tracker.autorun(function () {\n        const generatedAppsFromUser = GeneratedResources.find().map(function (resource) {\n          return resource.appId;\n        }); // console.log('onCreated generatedResources are: ', generatedAppsFromUser);\n        //now get all the apps from Qlik Sense, but filter them so that only the apps are show which the current user has generated\n\n        Meteor.subscribe('apps', generatedAppsFromUser);\n      }); //do the same but now for the streams\n\n      Tracker.autorun(function () {\n        const generatedStreamsFromUser = GeneratedResources.find().map(function (resource) {\n          return resource.streamId;\n        });\n        Meteor.subscribe('streams', generatedStreamsFromUser);\n      });\n    });\n  });\n}); // Template.generationStreams.onRendered(function() {\n//     this.$('.title')\n//         .popup({\n//             title: 'Streams',\n//             content: 'Via the QRS API we obtained the list of streams. Streams are a way to group apps that share a common purpose. In our case we give each customer its own stream.',\n//             delay: {\n//                 show: 1500,\n//                 hide: 0\n//             }\n//         });\n// })\n// Template.generationApps.onRendered(function() {\n//     this.$('.title')\n//         .popup({\n//             title: 'Apps',\n//             content: 'Via the QRS API we obtained the list of apps (dashboards). The app is at the core of Qlik Sense. An app is loaded with data, and the visualizations the app contains allow your customers to explore the data.',\n//             delay: {\n//                 show: 1500,\n//                 hide: 0\n//             }\n//         });\n// })","map":{"version":3,"sources":["imports/ui/generation/generation.js"],"names":["module","export","updateSenseInfo","Template","watch","require","v","Customers","dummyCustomers","Session","config","senseConfig","Apps","TemplateApps","GeneratedResources","APILogs","Streams","moment","default","generationApps","helpers","countApps","find","count","appSettings","collection","rowsPerPage","showFilter","showColumnToggles","fields","key","label","fn","value","object","get","Spacebars","SafeString","host","port","virtualProxyClientUsage","id","name","hidden","format","sortOrder","generationStreams","countStreams","streamSettings","generation","events","event","currentApp","console","log","target","className","Meteor","call","error","result","sAlert","currentStream","onRendered","set","message","QlikSense","$","accordion","onCreated","subscribe","templateAppsHandle","apiLogsHandle","customersHandle","onReady","onError","arguments","self","autorun","Tracker","generatedAppsFromUser","map","resource","appId","generatedStreamsFromUser","streamId"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport { Customers, dummyCustomers } from '/imports/api/customers';\nimport { Session } from 'meteor/session';\nimport { senseConfig as config } from '/imports/api/config';\nimport '/imports/ui/UIHelpers';\n\n\nimport './generation.html';\nimport './steps.js';\n\nimport { Apps, TemplateApps, GeneratedResources } from '/imports/api/apps';\nimport { APILogs } from '/imports/api/APILogs';\nimport { Streams } from '/imports/api/streams';\nimport './customer';\nimport './OEMPartnerSide/OEMPartner';\nimport moment from 'moment';\n\nTemplate.generationApps.helpers({\n    countApps() {\n        return Apps.find()\n            .count();\n    },\n    appSettings: function() {\n        // console.log('client generation helper: get app table, the config used to generate the URLs to Sense: ', config);\n        return {\n            collection: Apps,\n            rowsPerPage: 5,\n            showFilter: true,\n            showColumnToggles: true,\n            // fields: ['customer', 'telephone', 'email', 'status', 'itemCount', 'deliveryDate', 'remarks'],\n\n            fields: [{\n                    key: 'name',\n                    label: 'App',\n                    fn: function(value, object, key) {\n                        if (Session.get('currentStep') === 4 && Session.get('currentUser')) {\n                            return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/sense/app/' + object.id + ' target=\"_blank\">' + value + '</a>');\n                        } else {\n                            return object.name\n                        }\n                    }\n                }, {\n                    key: 'id',\n                    label: 'Guid',\n                    hidden: true,\n                    fn: function(value) {\n                        return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/sense/app/' + value + ' target=\"_blank\">' + value + '</a>');\n                    }\n                },\n                { key: 'description', label: 'description', hidden: true }, {\n                    key: 'modifiedDate',\n                    label: 'ModifiedDate',\n                    hidden: true,\n                    fn: function(value) {\n                        return moment(value)\n                            .format('DD-MM-YYYY');\n                    }\n                }, {\n                    key: 'stream.name',\n                    label: 'Stream',\n                    sortOrder: 1,\n                    fn: function(value, object) {\n                        return value;\n                    }\n                }, {\n                    key: 'published',\n                    label: 'Published',\n                    hidden: true\n                }, {\n                    key: 'lastReloadTime',\n                    label: 'Last reload',\n                    hidden: true,\n                    fn: function(value) {\n                        return moment(value)\n                            .format('MMMM Do YYYY, h:mm:ss a');\n                    }\n                }, {\n                    key: 'fileSize',\n                    label: 'File size',\n                    hidden: true,\n                    fn: function(value) {\n                        return value / 1000000\n                    }\n                },\n                //  {\n                //     key: 'copyApp',\n                //     label: 'Copy app selected customers',\n                //     hidden: true,\n                //     fn: function() {\n                //         return new Spacebars.SafeString('<i class=\"copy icon\"></i>')\n                //     }\n                // }, \n                // {\n                //     key: 'deleteApp',\n                //     label: 'Delete app',\n                //     hidden: true,\n                //     fn: function() {\n                //         return new Spacebars.SafeString('<i class=\"remove circle icon\"></i>')\n                //     }\n                // }, \n                // {\n                //     key: 'markAsTemplate',\n                //     label: 'Template app for generation?',\n                //     fn: function() {\n                //         return new Spacebars.SafeString('<i class=\"add circle icon\"></i>')\n                //     }\n                // }\n            ]\n        };\n    },\n})\n\nTemplate.generationStreams.helpers({\n    countStreams() {\n        return Streams.find()\n            .count();\n    },\n    streamSettings: function() {\n        return {\n            collection: Streams,\n            rowsPerPage: 5,\n            showFilter: true,\n            showColumnToggles: true,\n            fields: [{\n                    key: 'name',\n                    label: 'Stream',\n                    fn: function(value, object, key) {\n                        if (Session.get('currentStep') === 4 && Session.get('currentUser')) {\n                            return new Spacebars.SafeString('<a href=http://' + config.host + ':' + config.port + '/' + config.virtualProxyClientUsage + '/hub/stream/' + object.id + ' target=\"_blank\">' + value + '</a>');\n                        } else {\n                            return object.name\n                        }\n                    }\n                },\n                // { key: 'id', label: 'Guid' }, \n                {\n                    key: 'id',\n                    label: 'Guid',\n                    hidden: true\n                }, {\n                    key: 'createdDate',\n                    label: 'Created date',\n                    hidden: true,\n                    fn: function(value, object) {\n                        return moment(value)\n                            .format('DD-MM-YYYY');\n                    }\n                },\n                // {\n                //     key: 'deleteStream',\n                //     label: 'Delete',\n                //     hidden: true,\n                //     fn: function() {\n                //         return new Spacebars.SafeString('<i class=\"remove circle icon markAsTemplate\"></i>')\n                //     }\n                // },\n            ]\n        };\n    }\n})\n\nTemplate.generation.events({\n    'click .reactive-table tbody tr': function(event) {\n            var currentApp = this;\n            console.log(event);\n\n            // if (event.target.className == \"markAsTemplate\") {\n            //     console.log('markAsTemplate app clicked: ' + currentApp.name);\n            //     TemplateApps.upsert(currentApp._id, {\n            //         $set: {\n            //             name: currentApp.name,\n            //             id: currentApp.id,\n            //             generationUserId: Meteor.userId(),\n            //             checked: !this.checked\n            //         },\n            //     });\n            // }\n\n            //Copy APP\n            if (event.target.className === \"copyApp\") {\n                console.log('Copy app clicked: ' + currentApp.name);\n\n                Meteor.call('copyAppSelectedCustomers', currentApp, (error, result) => { //contains QVF guid of the current iteration over the apps  \n                        if (error) {\n                            sAlert.error(error);\n                        } else {\n                            // sAlert.success(\"QVF '\" + currentApp.name + \" copied in Qlik Sense via the QRS API for each of the selected customers\");\n                        }\n                    }) //method call \n            }\n\n            //DELETE APP\n            if (event.target.className === \"deleteApp\") {\n                console.log('delete app clicked: ' + currentApp.name);\n                Meteor.call('deleteApp', this.id, (error, result) => {\n                        if (error) {\n                            sAlert.error(error);\n                            console.log(error);\n                        } else {\n                            console.log('app removed');\n                            // sAlert.success(\"APP \" + currentApp.name + \" deleted in Qlik Sense via the QRS API\");\n                        }\n                    }) //method call \n            } //end if delete button is clicked \n\n            //DELETE Stream\n            if (event.target.className == \"deleteStream\") {\n                var currentStream = this;\n                console.log('delete stream clicked: ' + currentStream.name);\n                Meteor.call('deleteStream', this.id, (error, result) => {\n                        if (error) {\n                            sAlert.error(error);\n                            console.log(error);\n                        } else {\n                            console.log('Stream removed');\n                            // sAlert.success('Stream: ' + currentStream.name + \" deleted in Qlik Sense via the QRS API\");\n                        }\n                    }) //method call \n            } //delete stream event target\n\n        } //'click .reactive-table tbody tr        \n}); //end Meteor events\n\nexport var updateSenseInfo = function() {\n    Meteor.call('updateLocalSenseCopy');\n};\n\n//this code gets executed if the page has been loaded, so a good moment to Connect to Sense a get the most recent apps and streams\nTemplate.generation.onRendered(function() {\n    if (!Session.get('currentStep')) {\n        Session.set('currentStep', 1);\n    }\n    updateSenseInfo();\n\n    console.log('generated onRendered: Check if we have a connection to Sense?');\n    // $('.dimmer')\n    //     .dimmer('show');\n    Meteor.call('getStreams', (error, result) => {\n        if (error) {\n            console.error(error);\n            Session.set('NoSenseConnection', true);\n            sAlert.error(\"We can't connect to Qlik Sense, is your Sense VM running, all services started?, virtual proxy 'hdr' configured? Did you export the certificates and referred to them in the settings-XYZ.json in your project root? Also check the host/port (Qlik Sense) settings. Make sure you check the problem solving chapters in the installation manual (documentation-generic tab).\");\n        } else {\n            var message = \"Connected to Qlik Sense via the REST and websocket APIs. We registered a QRS notification event to ensure this MeteorJs platform automatically updates when Qlik Sense changes.\";\n            // console.log(message);\n            // sAlert.success(message);\n            Session.set('NoSenseConnection', false);\n        }\n    });\n\n})\n\nTemplate.QlikSense.onRendered(function() {\n    this.$('.ui.accordion')\n        .accordion();\n})\n\n\nTemplate.generation.onCreated(function() {\n    //see https://guide.meteor.com/data-loading.html\n    this.subscribe('streams');\n    this.subscribe('customers');\n\n    const templateAppsHandle = Meteor.subscribe('templateApps');\n    const apiLogsHandle = Meteor.subscribe('apiLogs');\n    const customersHandle = Meteor.subscribe('customers', { //http://stackoverflow.com/questions/28621132/meteor-subscribe-callback\n        onReady: function() {},\n        onError: function() {\n            console.log(\"onError\", arguments);\n        }\n    });\n\n\n    var self = this;\n    self.autorun(function() {\n        self.subscribe('generatedResources', function() {\n            // console.log('generatedResources changed, so update the apps subscription');\n            Tracker.autorun(function() {\n                const generatedAppsFromUser = GeneratedResources.find()\n                    .map(function(resource) {\n                        return resource.appId;\n                    });\n                // console.log('onCreated generatedResources are: ', generatedAppsFromUser);\n                //now get all the apps from Qlik Sense, but filter them so that only the apps are show which the current user has generated\n                Meteor.subscribe('apps', generatedAppsFromUser);\n            })\n\n            //do the same but now for the streams\n            Tracker.autorun(function() {\n                const generatedStreamsFromUser = GeneratedResources.find()\n                    .map(function(resource) {\n                        return resource.streamId;\n                    })\n                Meteor.subscribe('streams', generatedStreamsFromUser);\n            });\n        })\n    })\n})\n\n// Template.generationStreams.onRendered(function() {\n//     this.$('.title')\n//         .popup({\n//             title: 'Streams',\n//             content: 'Via the QRS API we obtained the list of streams. Streams are a way to group apps that share a common purpose. In our case we give each customer its own stream.',\n//             delay: {\n//                 show: 1500,\n//                 hide: 0\n//             }\n//         });\n// })\n\n// Template.generationApps.onRendered(function() {\n//     this.$('.title')\n//         .popup({\n//             title: 'Apps',\n//             content: 'Via the QRS API we obtained the list of apps (dashboards). The app is at the core of Qlik Sense. An app is loaded with data, and the visualizations the app contains allow your customers to explore the data.',\n//             delay: {\n//                 show: 1500,\n//                 hide: 0\n//             }\n//         });\n// })"]},"sourceType":"script","hash":"5624268d2c3d9f3e8301941e60425d777a6b015b"}
