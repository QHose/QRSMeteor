[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar _ = Package.underscore._;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar ReactiveDict = Package['reactive-dict'].ReactiveDict;\nvar Iron = Package['iron:core'].Iron;\n\n/* Package-scope variables */\nvar Controller;\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                         //\n// packages/iron_controller/lib/controller.js                                              //\n//                                                                                         //\n/////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                           //\n/*****************************************************************************/\n/* Imports */\n/*****************************************************************************/\nvar debug = Iron.utils.debug('iron:controller');\nvar Layout = Iron.Layout;\nvar DynamicTemplate = Iron.DynamicTemplate;\n\n/*****************************************************************************/\n/* Private */\n/*****************************************************************************/\nvar bindData = function (value, thisArg) {\n  return function () {\n    return (typeof value === 'function') ? value.apply(thisArg, arguments) : value;\n  };\n};\n\n/*****************************************************************************/\n/* Controller */\n/*****************************************************************************/\nController = function (options) {\n  var self = this;\n  this.options = options || {};\n  this._layout = this.options.layout || new Layout(this.options);\n  this._isController = true;\n  this._layout._setLookupHost(this);\n\n  // grab the event map from the Controller constructor which was\n  // set if the user does MyController.events({...});\n  var eventMap = Controller._collectEventMaps.call(this.constructor);\n  this._layout.events(eventMap, this);\n\n  this.init(options);\n};\n\n/**\n * Set or get the layout's template and optionally its data context.\n */\nController.prototype.layout = function (template, options) {\n  var self = this;\n\n  this._layout.template(template);\n\n  // check whether options has a data property\n  if (options && (_.has(options, 'data')))\n    this._layout.data(bindData(options.data, this));\n\n  return {\n    data: function (val) {\n      return self._layout.data(bindData(val, self));\n    }\n  };\n};\n\n/**\n * Render a template into a region of the layout.\n */\nController.prototype.render = function (template, options) {\n  var self = this;\n\n  if (options && (typeof options.data !== 'undefined'))\n    options.data = bindData(options.data, this);\n\n  var tmpl = this._layout.render(template, options);\n\n  // allow caller to do: this.render('MyTemplate').data(function () {...});\n  return {\n    data: function (func) {\n      return tmpl.data(bindData(func, self));\n    }\n  };\n};\n\n/**\n * Begin recording rendered regions.\n */\nController.prototype.beginRendering = function (onComplete) {\n  return this._layout.beginRendering(onComplete);\n};\n\n/*****************************************************************************/\n/* Controller Static Methods */\n/*****************************************************************************/\n/**\n * Inherit from Controller.\n *\n * Note: The inheritance function in Meteor._inherits is broken. Static\n * properties on functions don't get copied.\n */\nController.extend = function (props) {\n  return Iron.utils.extend(this, props); \n};\n\nController.events = function (events) {\n  this._eventMap = events;\n  return this;\n};\n\n/**\n * Returns a single event map merged from super to child.\n * Called from the constructor function like this:\n *\n * this.constructor._collectEventMaps()\n */\n\nvar mergeStaticInheritedObjectProperty = function (ctor, prop) {\n  var merge = {};\n\n  if (ctor.__super__)\n    _.extend(merge, mergeStaticInheritedObjectProperty(ctor.__super__.constructor, prop));\n  \n  return _.has(ctor, prop) ? _.extend(merge, ctor[prop]) : merge;\n};\n\nController._collectEventMaps = function () {\n  return mergeStaticInheritedObjectProperty(this, '_eventMap');\n};\n\n// NOTE: helpers are not inherited from one controller to another, for now.\nController._helpers = {};\nController.helpers = function (helpers) {\n  _.extend(this._helpers, helpers);\n  return this;\n};\n\n/*****************************************************************************/\n/* Global Helpers */\n/*****************************************************************************/\nif (typeof Template !== 'undefined') {\n  /**\n   * Returns the nearest controller for a template instance. You can call this\n   * function from inside a template helper.\n   *\n   * Example:\n   * Template.MyPage.helpers({\n   *   greeting: function () {\n   *    var controller = Iron.controller();\n   *    return controller.state.get('greeting');\n   *   }\n   * });\n   */\n  Iron.controller = function () {\n    //XXX establishes a reactive dependency which causes helper to run\n    return DynamicTemplate.findLookupHostWithProperty(Blaze.getView(), '_isController');\n  };\n\n  /**\n   * Find a lookup host with a state key and return it reactively if we have\n   * it.\n   */\n  Template.registerHelper('get', function (key) {\n    var controller = Iron.controller();\n    if (controller && controller.state)\n      return controller.state.get(key);\n  });\n}\n/*****************************************************************************/\n/* Namespacing */\n/*****************************************************************************/\nIron.Controller = Controller;\n\n/////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                         //\n// packages/iron_controller/lib/controller_server.js                                       //\n//                                                                                         //\n/////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                           //\nController.prototype.init = function () {};\n\nController.prototype.wait = function () {};\n\nController.prototype.ready = function () {\n  // for now there are no subscribe calls on the server. All data should\n  // be ready synchronously which means this.ready() should always be true.\n  return true;\n};\n\n/////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nPackage._define(\"iron:controller\");\n\n})();\n","servePath":"/packages/iron_controller.js"}]